в терминале перейти в папку scripts и выполнить команду

npx ts-node src/seed-roles.ts

Эта команда создаст коллекцию "roles" в Firestore и выполнит запись документов согласно логике скрипта

---

в терминале перейти в папку scripts/src/categories и выполнить команду

npx ts-node import-categories.ts

Эта команда НАПОЛНИТ коллекцию "categories" в Firestore и выполнит запись документов согласно логике скрипта

---

node src/export-collections.js - команду выполнять в папке /d/projects/FreshokFrontBack/scripts

Результат: в папке src создаст папку gpalette-uat/backup и в нее скачает json файл для каждой коллекции. Если в коллекции будет подколлекция, то структура json будет соответствовать этой схеме

---

node src/import-collections.js - команду выполнять в папке /d/projects/FreshokFrontBack/scripts

Результат: из папки gpalette-uat/backup считает json файлы для каждой коллекции и добавит поочередно в firestore, согласно структуре json файла. Если в структуре json файла будет подколлекция, то эта подколлекция будет вставлена в коллекцию

---

node src/export-single-collections.js users - команду выполнять в папке /d/projects/FreshokFrontBack/scripts

Результат: в папке src создаст папку gpalette-uat/backup и в нее скачает json файл для одной коллекции, которая была передана, как аргумент. В данном примере, была указана коллекция users. Если в коллекции будет подколлекция, то структура json будет соответствовать этой схеме

---

node src/import-single-collections.js users - команду выполнять в папке /d/projects/FreshokFrontBack/scripts

Результат: из папки gpalette-uat/backup считает json файл для коллекции, которая была передана как аргумент (в данном примере была передана коллекция users) и добавит эту коллекцию в firestore, согласно структуре json файла. Если в структуре json файла будет подколлекция, то эта подколлекция будет вставлена в коллекцию

---

=======================================================================================================
== Как экспортировать БД на локальный компьютер с Firestore в виде JSON файлов для каждой коллекции ==
=======================================================================================================

Чтобы выполнить экспорт коллекций с БД нужно иметь сервисный аккаунт, чтобы выполнить операции в проекте Firebase

1 Для того чтобы начать экспорт БД, нужно подготовить небольшой мини-проект, который будет выполнять операцию экспорта коллекций
Создать папку scripts и перейти в нее. В этой папке будем продолжать работать.
2 В папке scripts инициализируем новый проект
npm init -y
3 Для работы с Firestore и Firebase нам понадобится несколько пакетов
npm i @google-cloud/firestore
npm i firebase-admin
4 В папке scripts создаем подпапку src и внутри папки src создаем подпапку utils
5 В папку scripts добавляем сервисный аккаунт в виде json файла.
6 В папке utils создаем три файла

firestoreClient.js
progress.js
saveToFile.js

7 В папке src создаем такие файлы
export-single-collection.js
export-collections.js
8 В файле firestoreClient.js нужно указать путь к сервисному аккаунту, ID проекта (можно посмотреть в файле сервисного аккаунта) и название базы данных, с которой будем выполнять экспорт
9 В файле progress.js нужно указать путь, куда будет выполняться (сохраняться) экспорт
10 Чтобы запустить экспорт всех коллекций, нужно в терминале перейти в папку scripts и выполнить команду
node src/export-collections.js
11 По указанному в пункте 10 пути будет создана папка, в которую будут сохраняться json файлы для коллекций. Дополнительно будет создан файл progress.json, в который будет сохраняться отчет об экспортированных коллекциях. Если по какой-то причине экспорт будет прерван, то при повторном запуске команды node src/export-collections.js коллекции начнут экспортироваться с того места, где было прервано выполнение команды. 12 В случае успешного экспорта всех коллекций, файл progress.json будет удален автоматически.
13 Чтобы запустить экспорт одной коллекции, нужно перейти в папку scripts и в терминале выполнить команду
node src/export-single-collection.js <collection-name>
14 По указанному в пункте 10 пути будет создана папка, в которую будет сохранен json файл для коллекций. Дополнительно будет создан файл progress.json, в который будет сохраняться отчет об экспортированной коллекции. Если по какой-то причине экспорт будет прерван, то при повторном запуске команды node src/export-single-collection.js <collection-name> коллекция начнет экспортироваться с того места, где было прервано выполнение команды. В случае успешного экспорта коллекции, файл progress.json НЕ будет удален автоматически. Его нужно будет удалить руками.

==========================================================================================
== Как импортировать JSON файлы коллекций для БД с локального компьютера в Firestore ==
==========================================================================================

Чтобы выполнить импорт коллекций в Firestore, нужно иметь сервисный аккаунт, чтобы выполнить операции в проекте FIrebase

1 Если мини-проект не был создан по предыдущей инструкции, то выполнить пункты 1-6 из предыдущей инструкции
2 В папку src добавить папку backups c json файлами коллекций
3 В папке src создать файл
import-collections.js
4 В файле import-collections.js нужно указать путь к сервисному аккаунту, ID проекта (можно посмотреть в файле сервисного аккаунта), название базы данных, в которую будем выполнять импорт и путь к json файлам, которые будем импортировать
5 Чтобы запустить импорт всех коллекций, нужно в терминале перейти в папку scripts и выполнить команду
node src/import-collections.js
6 Во время импорта в папке с json файлами коллекций будет создан файл progress-import.json, в который будет сохраняться отчет об импортированных коллекциях. Если по какой-то причине импорт будет прерван, то при повторном запуске команды node src/import-collections.js коллекции начнут импортироваться с того места, где было прервано выполнение команды. В случае успешного импорта всех коллекций, файл progress-import.json будет удален автоматически.

=======================================================================================================
Для получения сервисного аккаунта в виде строки base64 перейти в терминале по тути scripts\src\json-to-base64
и выполнить команду

node json-to-base64.js ./freshok-market-prod-3e06755f1e30.json

АРГУМЕНТ ./freshok-market-prod-3e06755f1e30.json - путь к сервисному аккаунту, который нужно закодировать

В рузельтате в папке scripts\src\json-to-base64 появится файл .env c константой SERVICE_ACCOUNT и закодированной строкой. Преимущестро такого подхода - это одна сплошная строка без кавычек и переносов, что дает гаратнию того, что при парсинге ничего не сломается.
