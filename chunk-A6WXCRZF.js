import{b as se,d as ce,e as pe,f as de,g as le,h as me,i as ue,k as ge}from"./chunk-C5L6Q2C4.js";import{H as Me,I as Ie,J as De,K as we,h as fe,j as U,k as he,n as Ce,q as _e,r as ve,u as be,v as ye,y as Pe,z as xe}from"./chunk-K2246KKC.js";import{$ as m,Aa as Q,Ab as q,Bb as Y,Da as I,G as x,Ha as f,Ib as d,J as M,Ja as F,Jb as S,Ka as j,La as D,N as l,Qa as s,Ra as a,Sa as V,Vc as ee,Xc as te,Ya as T,Za as y,_ as K,ca as b,g as _,i as $,ib as p,jb as L,kb as P,lb as H,lc as X,nc as Z,nd as re,oa as o,pd as ie,q as G,qd as ne,r as v,sd as oe,ud as z,w as J,wd as ae,xa as u,zb as w}from"./chunk-KRK6O2AZ.js";import{a as C,b as O}from"./chunk-C6Q5SG76.js";var k=class i{langsService=l(ae);currentLang=z(this.langsService.currentLang$.pipe(G(t=>!!t),$(t=>t.browserLang)),{requireSync:!0});static \u0275fac=function(e){return new(e||i)};static \u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"})};var Se={id:"",publicId:"",badges:[],category:"",currency:"",code:"",discountPercent:0,hasDiscount:!1,i18n:{},description:{},characteristics:{},isActive:!1,isHit:!1,isNew:!1,price:0,searchKeywords:[],slug:"",stock:{},rate:0,reviewsCount:0,reviews:[],createdAt:0,updatedAt:0},Oe=class i{currentProduct=b(Se);reviews=b([]);currentProduct$=d(()=>this.currentProduct());reviews$=d(()=>this.currentProduct()?.reviews);constructor(){S(()=>{if(this.currentProduct()){let e=this.currentProduct().reviews.sort((r,n)=>n.createdAt-r.createdAt);this.reviews.set(e)}})}setCurrentPruduct(t){this.currentProduct.set(t)}updateCurrentProduct(t){this.currentProduct.update(e=>e&&C(C({},e),t))}addReview(t){let e=this.currentProduct().reviewsCount;this.reviews.update(r=>[t,...r]),this.updateCurrentProduct({reviews:this.reviews(),reviewsCount:e+1})}updateReview(t,e){this.reviews.update(r=>{let n=r.filter(c=>c.id!==t.id);return[t,...n]}),this.updateCurrentProduct({reviews:this.reviews(),rate:e})}removeReview(t){let e=this.currentProduct().reviewsCount;this.reviews.update(r=>r.filter(n=>n.id!==t)),this.updateCurrentProduct({reviews:this.reviews(),reviewsCount:e-1})}resetCurrentProduct(){this.currentProduct.set(Se)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"})};var A=class i{transform(t,e){let r=typeof t=="string"?parseFloat(t):t,n=typeof e=="string"?parseFloat(e):e;if(isNaN(r)||isNaN(n))return console.warn("calcDiscount: Invalid input values",{price:t,discount:e}),0;if(n<0||n>100)return console.warn("calcDiscount: Discount should be between 0 and 100",n),r;let c=r*(1-n/100);return Math.round(c*100)/100}static \u0275fac=function(e){return new(e||i)};static \u0275pipe=Q({name:"calcDiscount",type:i,pure:!0})};function ze(i,t){if(i&1&&(s(0,"span",2),p(1),w(2,"calcDiscount"),a()),i&2){let e=y();o(),H(" ",Y(2,2,e.product().price,e.product().discountPercent),"",e.product().currency," ")}}var Fe=class i{product=m.required();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=u({type:i,selectors:[["app-product-price"]],inputs:{product:[1,"product"]},decls:4,vars:5,consts:[[1,"product-card__price"],[1,"product-card__price-origin"],[1,"product-card__price-discount"]],template:function(e,r){e&1&&(s(0,"div",0)(1,"span",1),p(2),a(),I(3,ze,3,5,"span",2),a()),e&2&&(o(),F("cross",r.product().hasDiscount),o(),H(" ",r.product().price,"",r.product().currency," "),o(),D(r.product().hasDiscount?3:-1))},dependencies:[A],styles:['.price-row[_nghost-%COMP%]   .product-card__price[_ngcontent-%COMP%]{display:flex;flex-direction:row-reverse;align-items:center;justify-content:start;gap:8px}.price-row[_nghost-%COMP%]   .product-card__price-origin[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;line-height:1;letter-spacing:.5px}.price-row[_nghost-%COMP%]   .product-card__price-origin.cross[_ngcontent-%COMP%]{font-size:.75rem;line-height:1;letter-spacing:.3px}.price-row[_nghost-%COMP%]   .product-card__price-discount[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;line-height:1;letter-spacing:.5px}.big[_nghost-%COMP%]   .product-card__price[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:end;justify-content:start;gap:8px}.big[_nghost-%COMP%]   .product-card__price-origin[_ngcontent-%COMP%]{font-size:1.875rem;font-weight:700;line-height:1;letter-spacing:1px;color:var(--mat-sys-primary)}.big[_nghost-%COMP%]   .product-card__price-origin.cross[_ngcontent-%COMP%]{font-size:1.25rem;letter-spacing:.5px;color:inherit}.big[_nghost-%COMP%]   .product-card__price-origin.cross[_ngcontent-%COMP%]:after{background:linear-gradient(to bottom right,transparent calc(45% - 2px),var(--mat-sys-on-background) 50%,transparent calc(55% + 2px))}.big[_nghost-%COMP%]   .product-card__price-discount[_ngcontent-%COMP%]{font-size:1.875rem;font-weight:700;line-height:1;letter-spacing:.5px;color:var(--mat-sys-primary)}.medium[_nghost-%COMP%]   .product-card__price-origin[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;line-height:1;letter-spacing:1px;color:var(--mat-sys-primary)}.medium[_nghost-%COMP%]   .product-card__price-origin.cross[_ngcontent-%COMP%]{font-size:.875rem;letter-spacing:.5px;color:inherit}.medium[_nghost-%COMP%]   .product-card__price-discount[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;line-height:1;letter-spacing:.5px;color:var(--mat-sys-primary)}.product-card__price[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:start;justify-content:start;gap:3px;font-size:.875rem;letter-spacing:.5px}.product-card__price-origin.cross[_ngcontent-%COMP%]{position:relative;display:inline-block;opacity:.5}.product-card__price-origin.cross[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;background:linear-gradient(to bottom right,transparent calc(49% - 2px),var(--mat-sys-on-background) 50%,transparent calc(51% + 2px));pointer-events:none}'],changeDetection:0})};var N=class i{text=m.required();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=u({type:i,selectors:[["app-h3-title"]],inputs:{text:[1,"text"]},decls:2,vars:1,template:function(e,r){e&1&&(s(0,"h3"),p(1),a()),e&2&&(o(),P(" ",r.text(),`
`))},styles:["h3[_ngcontent-%COMP%]{font-family:Ruda,Arial,Helvetica,sans-serif;font-size:1.5rem;line-height:1.2;letter-spacing:2px;text-transform:uppercase}@media (max-width: 768px){h3[_ngcontent-%COMP%]{font-size:1.25rem}}"],changeDetection:0})};function ke(i,t){if(i&1&&(s(0,"p",4),p(1),a()),i&2){let e=y();o(),P('"',e.str(),'"')}}var R=class i{data=l(ce);translations=d(()=>this.data.translations);str=d(()=>this.data.info?.text??null);static \u0275fac=function(e){return new(e||i)};static \u0275cmp=u({type:i,selectors:[["app-delete-dialog"]],decls:15,vars:13,consts:[[1,"delete-dialog"],["mat-dialog-close","","iconName","close",1,"delete-dialog__close",3,"tooltipText"],["mat-dialog-title","",3,"text"],[1,"delete-dialog__question"],[1,"delete-dialog__substr"],["align","end"],["mat-button","","mat-dialog-close","","cdkFocusInitial",""],["mat-button","",3,"mat-dialog-close"]],template:function(e,r){e&1&&(s(0,"div",0),V(1,"app-btn-icon",1),w(2,"translate"),V(3,"app-h3-title",2),s(4,"mat-dialog-content")(5,"p",3),p(6),a(),I(7,ke,2,1,"p",4),a(),s(8,"mat-dialog-actions",5)(9,"button",6),p(10),w(11,"translate"),a(),s(12,"button",7),p(13),w(14,"translate"),a()()()),e&2&&(o(),f("tooltipText",q(2,7,"common.close")),o(2),f("text",r.translations().title),o(3),L(r.translations().question),o(),D(r.str()?7:-1),o(3),L(q(11,9,"common.cancel")),o(2),f("mat-dialog-close",(r.data.info==null?null:r.data.info.id)||!0),o(),L(q(14,11,"common.delete")))},dependencies:[N,te,ee,ue,de,le,me,oe,ne,ge],styles:[".delete-dialog[_ngcontent-%COMP%]{border:1px solid var(--mat-sys-primary);border-radius:28px}.delete-dialog__close[_ngcontent-%COMP%]{position:absolute;top:15px;right:15px;z-index:1}.delete-dialog__question[_ngcontent-%COMP%]{font-weight:600;font-size:1.2rem;margin-top:15px;margin-bottom:15px}"],changeDetection:0})};var B=X.lsSavedCart,Te=class i{apiService=l(Z);userAccessService=l(re);dialog=l(pe);translateService=l(ie);_items=b([]);_isLoading=b(!1);_error=b(null);items=this._items.asReadonly();isLoading=this._isLoading.asReadonly();error=this._error.asReadonly();dbUser=z(this.userAccessService.dbUser$,{initialValue:void 0});totalItems=d(()=>this._items().length);totalPrice=d(()=>this._items().reduce((t,e)=>{let r=e.price*(1-e.discountPercent/100);return t+r*e.quantity},0));isEmpty=d(()=>this._items().length===0);constructor(){S(()=>{let t=this.dbUser();if(t!==void 0)if(t)this.loadItemsFromServer().subscribe();else{let e=this.getItemsFromLS();this._items.set(e)}})}loadItemsFromServer(){return this._isLoading.set(!0),this.apiService.get("/cart").pipe(x(t=>{let e=this.mergeItems(t?.items||[]);this._items.set(e)}),v(t=>(console.error("[CartService] GetCart error:",t),this._error.set("Failed to get cart"),_(null))),J(()=>this._isLoading.set(!1)))}getItemsFromLS(){let t=localStorage.getItem(B);return t?JSON.parse(t):[]}saveItemsInLs(){localStorage.setItem(B,JSON.stringify(this._items()))}saveItemsOnServer(t){return this.apiService.post("/cart/save",{items:t}).pipe(v(e=>(console.error("[CartService] saveCart merge error:",e),this._error.set("Failed to save cart"),_(null))),x(()=>localStorage.removeItem(B)))}mergeItems(t){let e=this.getItemsFromLS();if(e.length===0)return t;let r=[...t];for(let n of e){let c=r.findIndex(g=>g.productId==n.productId);c!==-1?r[c]=O(C({},r[c]),{quantity:r[c].quantity+n.quantity}):r.push(n)}return this.saveItemsOnServer(r).subscribe(),r}addItem(t,e=1){let r={productId:t.id,badges:t.badges,quantity:e,price:t.price,hasDiscount:t.hasDiscount,discountPercent:t.discountPercent,currency:t.currency,publicId:t.publicId,slug:t.slug,i18n:t.i18n};this.applyUpsert(r),this.dbUser()?this.apiService.patch("/cart/item",r).pipe(x(n=>{this._items.set(n.items)}),v(n=>(console.error("[CartService] addItem error:",n),this._error.set("Failed to add item"),this.loadItemsFromServer().subscribe(),_(null)))).subscribe():this.saveItemsInLs()}removeItem(t){this._items.update(e=>e.filter(r=>r.productId!==t)),this.dbUser()?this.apiService.delete(`/cart/${t}`).pipe(x(e=>this._items.set(e.items)),v(e=>(console.error("[CartService] removeItem error:",e),this._error.set("Failed to remove item"),this.loadItemsFromServer().subscribe(),_(null)))).subscribe():this.saveItemsInLs()}updateQuantity(t,e){let r=e;if(!r)return;if(r<1){this.removeItem(t);return}let n=this.items().find(g=>g.productId===t);if(!n)return;let c=O(C({},n),{quantity:r});this._items.update(g=>g.map(W=>W.productId===t?c:W)),this.dbUser()?this.apiService.patch("/cart/item",c).pipe(x(g=>this._items.set(g.items)),v(g=>(console.error("[CartService] updateQuantity error:",g),this._error.set("Failed to update quantity"),this.loadItemsFromServer().subscribe(),_(null)))).subscribe():this.saveItemsInLs()}openClearCartDialog(){this.dialog.open(R,{panelClass:["green"],maxWidth:"700px",width:"100vw",enterAnimationDuration:"150ms",exitAnimationDuration:"150ms",data:{translations:this.translateService.instant("cart.clear-cart-dialog")}}).afterClosed().subscribe(e=>{e&&this.clearCart()})}clearCart(){this._items.set([]),this.dbUser()?this.apiService.delete("/cart/clear").pipe(v(t=>(console.error("[CartService] clearCart error:",t),this._error.set("Failed to clear cart"),_(null)))).subscribe():localStorage.removeItem(B)}applyUpsert(t){this._items.update(e=>{let r=e.findIndex(n=>n.productId===t.productId);return r!==-1?e.map((n,c)=>r==c?O(C({},n),{quantity:n.quantity+t.quantity}):n):[t,...e]})}static \u0275fac=function(e){return new(e||i)};static \u0275prov=M({token:i,factory:i.\u0275fac,providedIn:"root"})};var Le=class i{size=m("default");quantity=m(1);quantityChange=K();btnWidth=d(()=>this.size()=="default"?"24px":"44px");counter=new Ce(this.quantity(),[U.min(1),U.max(999)]);constructor(){S(()=>{this.counter.setValue(this.quantity(),{emitEvent:!1})})}onInput(t){let e=t.target,r=parseInt(e.value,10);r>999?r=999:r<1&&(r=1),this.counter.setValue(r,{emitEvent:!1})}increase(){let t=this.counter.value||1;if(t<999){let e=t+1;this.counter.setValue(e),this.quantityChange.emit(e)}}decrease(){let t=this.counter.value||1;if(t>1){let e=t-1;this.counter.setValue(e),this.quantityChange.emit(e)}}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=u({type:i,selectors:[["app-counter"]],inputs:{size:[1,"size"],quantity:[1,"quantity"]},outputs:{quantityChange:"quantityChange"},decls:5,vars:7,consts:[[1,"product-card__counter"],["borderRadius","0","iconName","remove","ariaLabel","Add to cart","iconColor","var(--mat-sys-on-secondary-container)",3,"click","width","isBadgeHidden"],[1,"no-subscript"],["matInput","","min","1","max","999","type","number",3,"input","formControl"],["borderRadius","0","iconName","add","ariaLabel","Add","iconColor","var(--mat-sys-on-secondary-container)",3,"click","width","isBadgeHidden"]],template:function(e,r){e&1&&(s(0,"div",0)(1,"app-mini-fab-btn",1),T("click",function(){return r.decrease()}),a(),s(2,"mat-form-field",2)(3,"input",3),T("input",function(c){return r.onInput(c)}),a()(),s(4,"app-mini-fab-btn",4),T("click",function(){return r.increase()}),a()()),e&2&&(F("big",r.size()=="big"),o(),f("width",r.btnWidth())("isBadgeHidden",!0),o(2),f("formControl",r.counter),o(),f("width",r.btnWidth())("isBadgeHidden",!0))},dependencies:[se,we,De,Me,Ie,Pe,fe,_e,he,ye,be,xe,ve],styles:[".product-card__counter[_ngcontent-%COMP%]{--mat-fab-small-touch-target-display: none;display:flex;align-items:center;justify-content:start;gap:0}.product-card__counter[_ngcontent-%COMP%]     mat-form-field .mdc-text-field{padding:0}@media (max-width: 576px){.product-card__counter[_ngcontent-%COMP%]{justify-content:center}}mat-form-field[_ngcontent-%COMP%]{--mdc-filled-text-field-container-shape: 0;--mat-form-field-container-vertical-padding: 0;width:100%;max-width:36px}mat-form-field[_ngcontent-%COMP%]{--mat-form-field-container-height: 24px}mat-form-field[_ngcontent-%COMP%]{--mat-form-field-container-text-line-height: 24px}mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{text-align:center}.product-card__counter.big[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{max-width:65px}.product-card__counter.big[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-size:1.25rem}.product-card__counter.big[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{--mat-form-field-container-height: 44px}.product-card__counter.big[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{--mat-form-field-container-text-line-height: 44px}"],changeDetection:0})};function Ae(i,t){if(i&1&&(s(0,"span",1),p(1),a()),i&2){let e=y();j(e.badge().color),o(),P(" -",e.discountPercent(),"% ")}}function Ee(i,t){if(i&1&&(s(0,"span",1),p(1),a()),i&2){let e=y();j(e.badge().color),o(),P(" ",e.badge().i18n[e.currentLang()]," ")}}var qe=class i{badge=m.required();discountPercent=m(0);isCart=m(!1);currentLang=l(k).currentLang;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=u({type:i,selectors:[["app-badge"]],inputs:{badge:[1,"badge"],discountPercent:[1,"discountPercent"],isCart:[1,"isCart"]},decls:2,vars:1,consts:[[1,"product-card__badge",3,"class"],[1,"product-card__badge"]],template:function(e,r){e&1&&I(0,Ae,2,3,"span",0)(1,Ee,2,3,"span",0),e&2&&D(r.badge().slug==="discount"?0:r.isCart()?-1:1)},styles:[".big[_nghost-%COMP%]   .product-card__badge[_ngcontent-%COMP%]{font-size:1rem;padding:5px 10px;font-weight:700;letter-spacing:.5px;line-height:1.2}.product-card__badge[_ngcontent-%COMP%]{display:block;padding:3px 6px;border-radius:6px;color:var(--mat-sys-on-background);background-color:var(--mat-sys-primary-container);background-color:var(--mat-sys-inverse-primary);font-size:.625rem;line-height:1;font-weight:700;letter-spacing:1px}"],changeDetection:0})};export{k as a,Fe as b,Oe as c,N as d,R as e,Te as f,Le as g,qe as h};
