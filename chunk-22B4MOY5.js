import{a as w}from"./chunk-63AB4ZGS.js";import{Ac as b,G as v,Ib as a,J as n,Jb as l,N as i,ca as r,d as c,dc as f,fc as P,h as d,i as u,nc as S,r as p,s as h,t as m,ud as g,v as y,vd as C}from"./chunk-KRK6O2AZ.js";var q=class s{productsService=i(w);route=i(f);router=i(P);breakpointObserver=i(b);restoreScrollService=i(C);userPrefferedView=r("grid");isLoading=r(!1);productsContainerWidth=r(0);products=r([]);pagination=r({});isSidenavOpenByDefault=r(!0);sidenavMode=r("side");isViewBtnsVisible=a(()=>this.productsContainerWidth()>=470);appliedView=a(()=>this.productsContainerWidth()>=470?this.userPrefferedView():"grid");isCardsBlockThin=a(()=>{let e=this.productsContainerWidth();return this.appliedView()=="grid"&&e<605});filtersSidenav=r(null);isWideScreen=g(this.breakpointObserver.observe(["(min-width: 805px)"]),{requireSync:!0});queryParams=g(this.route.queryParamMap.pipe(u(e=>e),y()));selectedCategory=a(()=>this.queryParams()?.get("category")||"all");currentPage=a(()=>{let e=this.queryParams()?.get("page");return e?parseInt(e,10):1});limit=a(()=>{let e=this.queryParams()?.get("limit");return e?parseInt(e,10):8});filterQuery=a(()=>{let t=this.queryParams()?.get("category"),o=this.currentPage(),x=this.limit();return[`page=${o}`,`limit=${x}`,`category=${t==="all"||!t?"":t}`,`badge=${this.queryParams()?.getAll("badge").join(",")||""}`,`priceMin=${this.queryParams()?.get("priceMin")||""}`,`priceMax=${this.queryParams()?.get("priceMax")||""}`,`sort=${this.queryParams()?.get("sort")||""}`].filter(M=>!!M.split("=")[1])});constructor(){l(()=>{let e=this.filtersSidenav(),t=this.isWideScreen().matches;e&&(t?(this.sidenavMode.set("side"),e.open()):(this.sidenavMode.set("over"),e.close()))}),l(()=>{this.filterQuery()&&this.getProductsByFilter()})}getProductsByFilter(){this.isLoading.set(!0),this.productsService.getProducts(this.filterQuery()).pipe(h(100)).subscribe({next:e=>{this.isLoading.set(!1),this.products.set(e.data),this.pagination.set(e.pagination)},error:e=>{console.error("Error loading products:",e),this.isLoading.set(!1)}})}setCategory(e){this.updateQueryParams({category:e,page:"1"})}setBadges(e){let t={page:"1"};if(e.length>0)t.badge=e.join(",");else{this.removeQueryParam("badge");return}this.updateQueryParams(t)}setPriceRange(e,t){let o={page:"1"};e&&(o.priceMin=e),t&&(o.priceMax=t),this.updateQueryParams(o)}clearPriceFilter(){this.router.navigate([],{relativeTo:this.route,queryParams:{priceMin:null,priceMax:null,page:"1"},queryParamsHandling:"merge",skipLocationChange:!1,replaceUrl:!0})}setSort(e){this.updateQueryParams({sort:e,page:"1"})}setLimit(e){this.updateQueryParams({limit:e.toString(),page:"1"})}goToPage(e){let t=this.pagination().totalPages||1;e<1||e>t||this.updateQueryParams({page:e.toString()})}nextPage(){let e=this.currentPage();this.pagination().hasNextPage&&this.goToPage(e+1)}previousPage(){let e=this.currentPage();this.pagination().hasPreviousPage&&this.goToPage(e-1)}updateQueryParams(e){setTimeout(()=>{this.router.navigate([],{relativeTo:this.route,queryParams:e,queryParamsHandling:"merge"}).then(()=>this.restoreScrollService.restoreScroll())},0)}removeQueryParam(e){setTimeout(()=>{this.router.navigate([],{relativeTo:this.route,queryParams:{[e]:null,page:"1"},queryParamsHandling:"merge"}).then(()=>this.restoreScrollService.restoreScroll())},0)}setProductsContainerWidth(e){this.productsContainerWidth.set(e)}setUserPrefferedView(e){this.userPrefferedView.set(e)}setFiltersSidebar(e){this.filtersSidenav.set(e)}static \u0275fac=function(t){return new(t||s)};static \u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"})};var j=class s{apiService=i(S);catalogListSubject=new c([]);selectedCategorySubject=new c("all");catalogList$=this.catalogListSubject.asObservable();selectedCategory$=this.selectedCategorySubject.asObservable();constructor(){this.getCatalogList().subscribe()}setSelectedCategory(e){this.selectedCategorySubject.next(e)}getCatalogList(){return this.apiService.getWithoutToken("/catalog").pipe(m(1),v(e=>this.catalogListSubject.next(e)),p(e=>(console.log("Error fetching catalog",e),d(()=>e))))}static \u0275fac=function(t){return new(t||s)};static \u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"})};export{j as a,q as b};
