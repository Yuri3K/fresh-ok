import{a as he,b as _e,c as Pe}from"./chunk-BJBK5PZY.js";import{a as J,b as Q,c as Y,f as ve}from"./chunk-EFYAV52P.js";import{A as me,C as se,D as le,E as ce,G as ue,H as de,I as ge,J as fe,K as Ce,b as Z,c as $,d as ee,h as te,j as b,k as oe,l as ie,p as ne,r as re,s as ae,x as pe,z as E}from"./chunk-K2246KKC.js";import{$ as l,Ab as p,Bb as z,Da as F,E as G,Ha as s,La as g,N as y,P as V,Q as O,Qa as a,Ra as m,Sa as c,Wa as W,Ya as f,Za as C,_ as x,ca as q,g as w,gc as U,i as N,ib as u,jb as L,kb as h,nc as K,o as B,oa as i,pd as X,qd as _,r as A,sd as v,tb as j,vb as H,w as R,xa as d,zb as r}from"./chunk-KRK6O2AZ.js";var Ee=(t,o)=>({minlength:t,currentlength:o});function Se(t,o){if(t&1&&(a(0,"mat-label"),u(1),m()),t&2){let e=C();i(),L(e.label())}}function Te(t,o){if(t&1&&(a(0,"mat-icon",2),u(1),m()),t&2){let e=C();i(),h(" ",e.suffixIcon()," ")}}function Me(t,o){if(t&1&&(a(0,"mat-hint"),u(1),m()),t&2){let e=C();i(),L(e.hint())}}function we(t,o){t&1&&(a(0,"mat-error"),u(1),r(2,"translate"),m()),t&2&&(i(),h(" ",p(2,1,"common.forms.name.nick-error-required")," "))}function Le(t,o){if(t&1&&(a(0,"mat-error"),u(1),r(2,"translate"),m()),t&2){let e=C();i(),h(" ",z(2,1,"common.forms.name.nick-error-minlength",H(4,Ee,e.nameControl().getError("minlength").requiredLength,e.nameControl().getError("minlength").actualLength))," ")}}var S=class t{nameControl=l.required();label=l("");placeholder=l("");hint=l("");suffixIcon=l("");static \u0275fac=function(e){return new(e||t)};static \u0275cmp=d({type:t,selectors:[["app-form-control-name"]],inputs:{nameControl:[1,"nameControl"],label:[1,"label"],placeholder:[1,"placeholder"],hint:[1,"hint"],suffixIcon:[1,"suffixIcon"]},decls:7,vars:7,consts:[["appearance","outline",1,"form-control"],["matInput","","type","'text",3,"placeholder","formControl"],["matSuffix",""]],template:function(e,n){e&1&&(a(0,"mat-form-field",0),F(1,Se,2,1,"mat-label"),c(2,"input",1),F(3,Te,2,1,"mat-icon",2)(4,Me,2,1,"mat-hint")(5,we,3,3,"mat-error")(6,Le,3,7,"mat-error"),m()),e&2&&(i(),g(n.label()?1:-1),i(),s("placeholder",n.placeholder())("formControl",n.nameControl()),i(),g(n.suffixIcon()?3:-1),i(),g(n.hint()?4:-1),i(),g(n.nameControl().hasError("required")&&n.nameControl().touched?5:-1),i(),g(n.nameControl().hasError("minlength")&&n.nameControl().touched?6:-1))},dependencies:[ge,de,se,ce,le,ue,E,te,oe,re,Ce,fe,$,Z,v,_],styles:["[_nghost-%COMP%]{width:100%}.form-control[_ngcontent-%COMP%]{width:100%}"],changeDetection:0})};function xe(t){return o=>o.value?B(400).pipe(G(()=>t.postWithoutToken("/register-user/check-email",{email:o.value}).pipe(N(e=>e.exists?{emailExists:!0}:null),A(()=>w(null))))):w(null)}function De(t,o){t&1&&c(0,"app-loader")}function Ie(t,o){if(t&1){let e=W();a(0,"form",1),f("ngSubmit",function(){V(e);let P=C();return O(P.onSubmit())}),c(1,"app-form-control-name",2),r(2,"translate"),r(3,"translate"),r(4,"translate"),c(5,"app-form-control-email",3),r(6,"translate"),r(7,"translate"),c(8,"app-form-control-pwd",4),r(9,"translate"),r(10,"translate"),c(11,"app-btn-flat",5),r(12,"translate"),m()}if(t&2){let e=C();s("formGroup",e.registerForm),i(),s("nameControl",e.displayNameControl)("label",p(2,13,"common.forms.name.enter-nick"))("hint",p(3,15,"common.forms.name.nick-hint"))("placeholder",p(4,17,"common.forms.name.nick-placeholder")),i(4),s("emailControl",e.emailControl)("label",p(6,19,"common.forms.email.enter-email"))("hint",p(7,21,"common.forms.email.email-hint")),i(3),s("pwdControl",e.passwordControl)("label",p(9,23,"common.forms.pwd.enter-pwd"))("hint",p(10,25,"common.forms.pwd.pwd-hint")),i(3),s("btnText",p(12,27,"register-page.title"))("btnDisabled",e.registerForm.invalid)}}var T=class t{isPopup=l(!1);registerByEmailAndPwdEmited=x();fb=y(pe);apiService=y(K);snackbarService=y(Q);translateService=y(X);authService=y(Y);submitting=q(!1);registerForm=this.fb.group({displayName:["testUser1",[b.required,b.minLength(2)]],email:["testuser1@gmail.com",[b.required,b.email],[xe(this.apiService)]],password:["123456",[b.required,b.minLength(6)]]});get displayNameControl(){return this.registerForm.get("displayName")}get emailControl(){return this.registerForm.get("email")}get passwordControl(){return this.registerForm.get("password")}ngOnInit(){this.emailControl.statusChanges.subscribe(o=>{o==="INVALID"&&this.emailControl.hasError("emailExists")&&(this.emailControl.markAsTouched(),this.emailControl.markAsDirty())})}onSubmit(){if(this.registerForm.invalid)return;this.submitting.set(!0);let o=this.registerForm.value,e=J();this.apiService.postWithoutToken("/register-user",o).pipe(R(()=>{this.submitting.set(!1)})).subscribe({next:async n=>{n.result=="ok"&&(this.registerForm.reset(),this.authService.signInWithEmailAndPassword(o.email,o.password).subscribe())},error:n=>{let P=this.translateService.instant("register-page.register-error",{email:o.email});this.snackbarService.openSnackBar(P),console.log("error register user",n)}}),this.isPopup()&&this.registerByEmailAndPwdEmited.emit()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=d({type:t,selectors:[["app-register-form"]],inputs:{isPopup:[1,"isPopup"]},outputs:{registerByEmailAndPwdEmited:"registerByEmailAndPwdEmited"},decls:2,vars:1,consts:[[1,"register__form",3,"formGroup"],[1,"register__form",3,"ngSubmit","formGroup"],["suffixIcon","person",3,"nameControl","label","hint","placeholder"],[3,"emailControl","label","hint"],[3,"pwdControl","label","hint"],["type","submit",3,"btnText","btnDisabled"]],template:function(e,n){e&1&&F(0,De,1,0,"app-loader")(1,Ie,13,29,"form",0),e&2&&g(n.submitting()?0:1)},dependencies:[E,ne,ie,ae,me,he,_e,S,v,_,ve],styles:["[_nghost-%COMP%]{width:100%;max-width:400px}.register__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px}"],changeDetection:0})};var ke=()=>["/login"],M=class t{isPopup=l(!1);openLoginPopup=x();onLoginClick(o){this.isPopup()&&(o.preventDefault(),this.openLoginPopup.emit())}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=d({type:t,selectors:[["app-go-to-login"]],inputs:{isPopup:[1,"isPopup"]},outputs:{openLoginPopup:"openLoginPopup"},decls:8,vars:11,consts:[[1,"login__link",3,"click","routerLink"]],template:function(e,n){e&1&&(a(0,"p"),u(1),r(2,"translate"),a(3,"a",0),f("click",function(ye){return n.onLoginClick(ye)}),u(4),r(5,"translate"),m(),u(6),r(7,"translate"),m()),e&2&&(i(),h(" ",p(2,4,"register-page.go-to-login.prefix")," "),i(2),s("routerLink",n.isPopup()?null:j(10,ke)),i(),h(" ",p(5,6,"register-page.go-to-login.link")," "),i(2),h(" ",p(7,8,"register-page.go-to-login.suffix")," "))},dependencies:[v,_,U],styles:["p[_ngcontent-%COMP%]{text-align:center;line-height:1.2}.login__link[_ngcontent-%COMP%]{text-decoration:none;color:var(--mat-sys-primary);cursor:pointer}"],changeDetection:0})};var be=class t{isPopup=l(!1);closePopup=x();openLoginPopup=x();switchToLoginPopup(){this.openLoginPopup.emit()}closeRegisterPopup(){this.closePopup.emit()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=d({type:t,selectors:[["app-register"]],inputs:{isPopup:[1,"isPopup"]},outputs:{closePopup:"closePopup",openLoginPopup:"openLoginPopup"},decls:6,vars:6,consts:[[1,"register"],[3,"text"],[3,"registerByEmailAndPwdEmited","isPopup"],[3,"openLoginPopup","isPopup"],[3,"submitWithGoogleEmited","isPopup"]],template:function(e,n){e&1&&(a(0,"div",0),c(1,"app-h2-title",1),r(2,"translate"),a(3,"app-register-form",2),f("registerByEmailAndPwdEmited",function(){return n.closeRegisterPopup()}),m(),a(4,"app-go-to-login",3),f("openLoginPopup",function(){return n.switchToLoginPopup()}),m(),a(5,"app-google-btn",4),f("submitWithGoogleEmited",function(){return n.closeRegisterPopup()}),m()()),e&2&&(i(),s("text",p(2,4,"register-page.title")),i(2),s("isPopup",n.isPopup()),i(),s("isPopup",n.isPopup()),i(),s("isPopup",n.isPopup()))},dependencies:[v,_,ee,T,M,Pe],styles:[".register[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:40px}"],changeDetection:0})};export{S as a,be as b};
