import{a as q,f as j}from"./chunk-A6WXCRZF.js";import{c as R}from"./chunk-4TIFUWTH.js";import{b as F}from"./chunk-C5L6Q2C4.js";import{$ as s,Ab as d,G as v,Ha as g,Ib as r,J as D,Jb as k,Ka as I,N as o,Qa as h,Qb as L,Ra as b,Sa as z,W as B,Ya as _,ca as p,g as c,ib as M,kb as x,ma as w,nc as H,nd as W,oa as T,pd as N,qd as C,r as m,sd as y,ud as O,w as f,xa as u,zb as a}from"./chunk-KRK6O2AZ.js";var A=class n{currentLang=o(q).currentLang;status=s.required();static \u0275fac=function(e){return new(e||n)};static \u0275cmp=u({type:n,selectors:[["app-product-status"]],inputs:{status:[1,"status"]},decls:2,vars:3,consts:[[1,"product__status"]],template:function(e,i){e&1&&(h(0,"div",0),M(1),b()),e&2&&(I(i.status().slug),T(),x(" ",i.status().i18n[i.currentLang()],`
`))},styles:[".big[_nghost-%COMP%]   .product__status[_ngcontent-%COMP%]{font-size:1rem;letter-spacing:.5px}.product__status[_ngcontent-%COMP%]{text-transform:uppercase;font-size:.625rem;font-weight:600;line-height:1;letter-spacing:.3px}.product__status.in-stock[_ngcontent-%COMP%]{color:var(--mat-sys-primary-fixed-dim)}.product__status.low-stock[_ngcontent-%COMP%]{color:var(--mat-sys-error)}.product__status.out-of-stock[_ngcontent-%COMP%]{opacity:.6}"],changeDetection:0})};var S=class n{apiService=o(H);userAccessService=o(W);signDialogService=o(R);_productIds=p([]);_isLoading=p(!1);_error=p("");productIds=this._productIds.asReadonly();isLoading=this._isLoading.asReadonly();error=this._error.asReadonly();totalFavs=r(()=>this._productIds().length);dbUser=O(this.userAccessService.dbUser$,{initialValue:void 0});pendingIds=new Set;constructor(){k(()=>{let t=this.dbUser();t!==void 0&&(t?this.loadFromServer():this._productIds.set([]))})}isFav(t){return this._productIds().includes(t)}isPending(t){return this.pendingIds.has(t)}toggleFav(t){if(!this.dbUser()){this.signDialogService.openLoginDialog();return}this.isPending(t)||(this.isFav(t)?this.removeFav(t):this.addFav(t))}loadFromServer(){this._isLoading.set(!0),this.apiService.get("/favs/").pipe(v(t=>this._productIds.set(t.productIds??[])),m(t=>(console.error("[FavsService] loadFromServer error:",t),this._error.set("Failed to load Favs"),c(null))),f(()=>this._isLoading.set(!1))).subscribe()}addFav(t){this.pendingIds.add(t),this._productIds.update(e=>[...e,t]),this.apiService.post("/favs",{productId:t}).pipe(v(e=>this._productIds.set(e.productIds??[])),m(e=>(console.error("[FavsService] addFav error:",e),this._error.set("Failed to add fav"),this._productIds.update(i=>i.filter(l=>l!==t)),c(null))),f(()=>this.pendingIds.delete(t))).subscribe()}removeFav(t){this.pendingIds.add(t),this._productIds.update(e=>e.filter(i=>i!==t)),this.apiService.delete(`/favs/${t}`).pipe(v(e=>{this._productIds.set(e.productIds??[])}),m(e=>(console.log("[FavsService] removeFav error",e),this._error.set("'Failed to remove fav'"),this._productIds.update(i=>[...i,t]),c(null))),f(()=>this.pendingIds.delete(t))).subscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=D({token:n,factory:n.\u0275fac,providedIn:"root"})};var E=class n{product=s.required();size=s("default");favsService=o(S);btnWidth=r(()=>this.size()=="default"?"40px":"44px");isFav=r(()=>this.favsService.isFav(this.product().id));isDisabled=r(()=>this.favsService.isPending(this.product().id));toggleFav(){this.favsService.toggleFav(this.product().id)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=u({type:n,selectors:[["app-product-fav-btn"]],inputs:{product:[1,"product"],size:[1,"size"]},decls:3,vars:10,consts:[["iconColor","var(--mat-sys-on-secondary-container)",1,"product-card__fav",3,"click","width","iconName","tooltipText","ariaLabel","isBadgeHidden","btnDisabled"]],template:function(e,i){e&1&&(h(0,"app-mini-fab-btn",0),a(1,"translate"),a(2,"translate"),_("click",function(){return i.toggleFav()}),b()),e&2&&g("width",i.btnWidth())("iconName",i.isFav()?"favorite":"favorite_border")("tooltipText",d(1,6,i.isFav()?"common.remove-from-favs":"common.add-to-favs"))("ariaLabel",d(2,8,"common.add-to-favs"))("isBadgeHidden",!0)("btnDisabled",i.isDisabled())},dependencies:[F,y,C],encapsulation:2,changeDetection:0})};var $=class n{product=s.required();quantity=s(1);size=s("default");OnResize(){this.windowWidth.set(window.innerWidth)}handleClick(){this.addToCart()}translateService=o(N);destroyRef=o(B);cartService=o(j);translations=this.translateService.stream("common.add-to-cart");windowWidth=p(window.innerWidth);btnHeight=r(()=>this.size()=="default"?"40px":"44px");btnWidth=r(()=>this.size()=="default"?"40px":"auto");btnText=r(()=>this.size()=="big"&&this.windowWidth()>1024?this.translations:c(null));addToCart(){this.cartService.addItem(this.product(),this.quantity())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=u({type:n,selectors:[["app-product-cart-btn"]],hostBindings:function(e,i){e&1&&_("resize",function(){return i.OnResize()},!1,w)("click",function(G){return i.handleClick(G)})},inputs:{product:[1,"product"],quantity:[1,"quantity"],size:[1,"size"]},decls:4,vars:12,consts:[["iconName","shopping_cart","btnPadding","8px","iconColor","var(--mat-sys-on-secondary-container)",3,"height","width","tooltipText","isBadgeHidden","btnText"]],template:function(e,i){e&1&&(z(0,"app-mini-fab-btn",0),a(1,"translate"),a(2,"translate"),a(3,"async")),e&2&&g("height",i.btnHeight())("width",i.btnWidth())("tooltipText",d(1,6,"common.add-to-cart"))("tooltipText",d(2,8,"common.add-to-cart"))("isBadgeHidden",!0)("btnText",d(3,10,i.btnText()))},dependencies:[F,y,C,L],encapsulation:2,changeDetection:0})};export{A as a,S as b,E as c,$ as d};
