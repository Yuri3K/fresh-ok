<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Fresh-ok</title>
  <meta name="description"
    content="Welcome to the Freshok online marketplace. Here you can always find fresh and affordable groceries." />
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Может использоваться браузерами в особых случаях (например, для больших фавиконок в интерфейсе, при увеличении масштаба) -->
  <link rel="icon" type="image/png" href="assets/images/favicon/favicon-96x96.png" sizes="96x96" />

  <!-- Браузеры, поддерживающие SVG (Firefox, Chrome, некоторые другие), будут использовать эту иконку -->
  <link rel="icon" type="image/svg+xml" href="assets/images/favicon/favicon.svg" />

  <!-- Фолбэк для браузеров, которые не поддерживают SVG -->
  <link rel="shortcut icon" href="assets/images/favicon/favicon.ico" />

  <!-- Иконка для добавления сайта на домашний экран iOS (iPhone/iPad) и в док macOS Safari -->
  <link rel="apple-touch-icon" sizes="180x180" href="assets/images/favicon/apple-touch-icon.png" />

  <!-- Задаёт короткое имя приложения (до 12 символов), которое будет отображаться под иконкой на домашнем экране iOS, когда пользователь добавит сайт туда. Если этого тега нет, используется содержимое <title> (которое может быть длиннее) -->
  <meta name="apple-mobile-web-app-title" content="Fresh-ok" />

  <!-- Файл Web App Manifest — "сердце" PWA (Progressive Web App). В нём указываются:
    Название приложения, тема, фон
    Набор иконок для Android (при добавлении на экран дома)
    Способ запуска (полноэкранный, как приложение)
    Ориентация экрана и т.д. -->
  <link rel="manifest" href="assets/images/favicon/site.webmanifest" />

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <style>
    #app-preloader {
      position: fixed;
      inset: 0;
      background: #121316;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      font-family: Roboto, Arial, sans-serif;
    }

    .spinner {
      text-align: center;
      max-width: 380px;
      padding: 24px;
      transform: scale(0);
      transition: transform 0.5s ease;
    }

    .spinner.show {
      transform: scale(1);
    }

    #preloader-timer {
      margin-top: 16px;
      font-size: 14px;
      opacity: 0.85;
    }

    .heading {
      font-size: 1.5rem;
      font-weight: bold;
    }

    .text {
      font-size: 1.25rem;
      margin-top: 15px;
      line-height: 1.2;
    }
  </style>

  <script>
    (function () {
      if (
        !location.hostname.endsWith('github.io') ||
        !location.hostname.endsWith('onrender.com')
      ) return;

      const redirect = sessionStorage.getItem('redirect');

      if (redirect) {
        sessionStorage.removeItem('redirect');
        history.replaceState(null, null, redirect);
      }
    })();
  </script>

  <script>
    (function () {
      if (
        !location.hostname.endsWith('github.io') ||
        !location.hostname.endsWith('onrender.com')
      ) return;

      const base = '/fresh-ok/';
      const supported = ['en', 'ru', 'uk'];

      let path = location.pathname.replace(base, '').replace(/^\/+/, '');

      if (!path) {
        location.replace(base + 'en/home');
        return;
      }

      const [first, ...rest] = path.split('/');

      if (supported.includes(first)) return;

      const stored = localStorage.getItem('lang');
      const browser = navigator.language?.split('-')[0];

      const lang =
        supported.includes(stored) ? stored :
          supported.includes(browser) ? browser :
            'en';

      location.replace(base + lang + '/' + path);
    })();
  </script>


</head>

<body>
  <app-root></app-root>

  <script>
    const PRELOADER_I18N = {
      ru: {
        title: 'Загрузка приложения.',
        wait: 'Пожалуйста, подождите.',
        note: 'При холодном старте сервера это может занять до 1 минуты.',
        timer: (s) => `Осталось: ${s} сек`,
        almost: 'Почти готово…'
      },
      en: {
        title: 'Loading application.',
        wait: 'Please wait.',
        note: 'Cold server start may take up to 1 minute.',
        timer: (s) => `Remaining: ${s} sec`,
        almost: 'Almost ready…'
      },
      uk: {
        title: 'Завантаження застосунку.',
        wait: 'Будь ласка, зачекайте.',
        note: 'Холодний старт сервера може тривати до 1 хвилини.',
        timer: (s) => `Залишилось: ${s} сек`,
        almost: 'Майже готово…'
      }
    };
  </script>

  <script>
    function detectLangFromUrl() {
      const supported = ['ru', 'en', 'uk'];

      // /fresh-ok/en/home → ["fresh-ok", "en", "home"]
      const segments = location.pathname.split('/').filter(Boolean);

      const lang = segments.find(seg => supported.includes(seg));
      return lang || 'en'; // fallback
    }
  </script>

  <script>
    (function () {
      const lang = detectLangFromUrl();
      const t = PRELOADER_I18N[lang] || PRELOADER_I18N.en;

      const preloader = document.createElement('div');
      const box = document.createElement('div');
      const timerEl = document.createElement('div');

      preloader.id = 'app-preloader';
      box.className = 'spinner';

      box.innerHTML = `
      <h2 class="heading">${t.title}</h2>
      <p class="text">${t.wait}</p>
      <p class="text">${t.note}</p>
    `;

      timerEl.id = 'preloader-timer';
      box.appendChild(timerEl);
      preloader.appendChild(box);
      document.body.appendChild(preloader);

      setTimeout(() => {
        const el = document.querySelector('.spinner')
        if (el) {
          el.classList.add('show')

          let seconds = 60;
          timerEl.textContent = t.timer(seconds);

          const interval = setInterval(() => {
            seconds--;
            timerEl.textContent = t.timer(seconds);

            if (seconds <= 0) {
              clearInterval(interval);
              timerEl.textContent = t.almost;
            }
          }, 1000);
        }
      }, 1500);

    })();
  </script>
</body>

</html>