import{a as st}from"./chunk-KFEAACNQ.js";import{a as te,b as ie}from"./chunk-I3CB24SV.js";import{b as rt,c as nt}from"./chunk-7C65LZ6Y.js";import{b as at}from"./chunk-DUDR6KYA.js";import"./chunk-7QZPI3VT.js";import"./chunk-A6WXCRZF.js";import"./chunk-4TIFUWTH.js";import"./chunk-3HT6ZPWY.js";import"./chunk-V6BX3QGA.js";import"./chunk-BJBK5PZY.js";import{f as ot}from"./chunk-EFYAV52P.js";import{a as Ke,c as Ge,d as Je,e as Ze,h as et,i as tt}from"./chunk-C5L6Q2C4.js";import{A as it,d as ee}from"./chunk-K2246KKC.js";import{Ab as j,Da as S,F as fe,Ga as xe,Ha as x,Ia as P,Ib as Be,J as Ve,Ja as G,Jb as q,La as He,N as M,Nb as J,O as Ue,Oa as We,P as p,Pa as Ee,Q as l,Qa as m,Ra as h,Sa as u,Ta as ke,Tb as je,Ua as Le,Wa as E,Xc as Ye,Ya as g,Za as c,_ as O,bb as _e,bc as qe,c as Pe,ca as A,cb as Ce,db as ve,ec as Xe,ib as L,jb as ye,la as W,ma as De,n as V,nc as Z,oa as f,p as ue,qd as Ne,sa as K,sd as Qe,x as Fe,xa as b,xd as $e,zb as B}from"./chunk-KRK6O2AZ.js";import{a as _,b as T}from"./chunk-C6Q5SG76.js";var ft=["wrapper"],xt=["sourceImage"];function _t(r,e){if(r&1){let t=E();m(0,"img",5,0),g("load",function(){p(t);let o=c();return l(o.imageLoadedInView())})("mousedown",function(o){p(t);let a=c();return l(a.startMove(o,a.moveTypes.Drag))})("touchstart",function(o){p(t);let a=c();return l(a.startMove(o,a.moveTypes.Drag))})("error",function(o){p(t);let a=c();return l(a.loadImageError(o))}),h()}if(r&2){let t=e.ngIf,i=c();P("visibility",i.imageVisible?"visible":"hidden")("transform",i.safeTransformStyle()),G("ngx-ic-draggable",!i.disabled&&i.allowMoveImage),x("src",t,W),xe("alt",i.imageAltText)}}function Ct(r,e){if(r&1){let t=E();ke(0),m(1,"span",9),g("mousedown",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"topleft"))})("touchstart",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"topleft"))}),u(2,"span",10),h(),m(3,"span",11),g("mousedown",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"topright"))})("touchstart",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"topright"))}),u(4,"span",10),h(),m(5,"span",12),g("mousedown",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"bottomright"))})("touchstart",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"bottomright"))}),u(6,"span",10),h(),m(7,"span",13),g("mousedown",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"bottomleft"))})("touchstart",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"bottomleft"))}),u(8,"span",10),h(),m(9,"span",14),g("mousedown",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"top"))})("touchstart",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"top"))}),h(),m(10,"span",15),g("mousedown",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"top"))})("touchstart",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"top"))}),u(11,"span",10),h(),m(12,"span",16),g("mousedown",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"right"))})("touchstart",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"right"))}),h(),m(13,"span",17),g("mousedown",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"right"))})("touchstart",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"right"))}),u(14,"span",10),h(),m(15,"span",18),g("mousedown",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"bottom"))})("touchstart",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"bottom"))}),h(),m(16,"span",19),g("mousedown",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"bottom"))})("touchstart",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"bottom"))}),u(17,"span",10),h(),m(18,"span",20),g("mousedown",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"left"))})("touchstart",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"left"))}),h(),m(19,"span",21),g("mousedown",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"left"))})("touchstart",function(o){p(t);let a=c(2);return l(a.startMove(o,a.moveTypes.Resize,"left"))}),u(20,"span",10),h(),Le()}}function vt(r,e){if(r&1){let t=E();m(0,"div",6),g("keydown",function(o){p(t);let a=c();return l(a.keyboardAccess(o))}),m(1,"div",7),g("mousedown",function(o){p(t);let a=c();return l(a.startMove(o,a.moveTypes.Move))})("touchstart",function(o){p(t);let a=c();return l(a.startMove(o,a.moveTypes.Move))}),h(),S(2,Ct,21,0,"ng-container",8),h()}if(r&2){let t=c();P("top",t.state.cropper().y1,"px")("left",t.state.cropper().x1,"px")("width",t.state.cropper().x2-t.state.cropper().x1,"px")("height",t.state.cropper().y2-t.state.cropper().y1,"px")("margin-left",t.state.options.alignImage==="center"?t.marginLeft:null)("visibility",t.imageVisible?"visible":"hidden"),G("ngx-ic-round",t.state.options.roundCropper),xe("aria-label",t.state.options.cropperFrameAriaLabel),f(2),x("ngIf",!t.state.options.hideResizeSquares&&!(t.state.options.cropperStaticWidth&&t.state.options.cropperStaticHeight))}}function X(r,e,t){return r=yt(r,e),oe(r,e,t)}function yt(r,e){let t=r.x2-r.x1,i=r.y2-r.y1,o=r.x1+t/2,a=r.y1+i/2;e.options.cropperStaticHeight&&e.options.cropperStaticWidth?(t=e.maxSize().width>e.options.cropperStaticWidth?e.options.cropperStaticWidth:e.maxSize().width,i=e.maxSize().height>e.options.cropperStaticHeight?e.options.cropperStaticHeight:e.maxSize().height):(t=Math.max(e.cropperScaledMinWidth,Math.min(t,e.cropperScaledMaxWidth,e.maxSize().width)),i=Math.max(e.cropperScaledMinHeight,Math.min(i,e.cropperScaledMaxHeight,e.maxSize().height)),e.options.maintainAspectRatio&&(e.maxSize().width/e.options.aspectRatio<e.maxSize().height?i=t/e.options.aspectRatio:t=i*e.options.aspectRatio));let s=o-t/2,n=s+t,d=a-i/2,C=d+i;return{x1:s,x2:n,y1:d,y2:C}}function oe(r,e,t=!1){return r.x1<0&&(r=T(_({},r),{x1:0,x2:r.x2-(t?r.x1:0)})),r.y1<0&&(r=T(_({},r),{y2:r.y2-(t?r.y1:0),y1:0})),r.x2>e.maxSize().width&&(r=T(_({},r),{x1:r.x1-(t?r.x2-e.maxSize().width:0),x2:e.maxSize().width})),r.y2>e.maxSize().height&&(r=T(_({},r),{y1:r.y1-(t?r.y2-e.maxSize().height:0),y2:e.maxSize().height})),r}function Mt(r,e){let t=ae(r)-e.clientX,i=re(r)-e.clientY;return{x1:e.cropper.x1+t,y1:e.cropper.y1+i,x2:e.cropper.x2+t,y2:e.cropper.y2+i}}function ct(r,e,t){let i=_({},t.cropper()),o=ae(r)-e.clientX,a=re(r)-e.clientY;switch(e.position){case"left":i.x1=Math.min(Math.max(e.cropper.x1+o,i.x2-t.cropperScaledMaxWidth),i.x2-t.cropperScaledMinWidth);break;case"topleft":i.x1=Math.min(Math.max(e.cropper.x1+o,i.x2-t.cropperScaledMaxWidth),i.x2-t.cropperScaledMinWidth),i.y1=Math.min(Math.max(e.cropper.y1+a,i.y2-t.cropperScaledMaxHeight),i.y2-t.cropperScaledMinHeight);break;case"top":i.y1=Math.min(Math.max(e.cropper.y1+a,i.y2-t.cropperScaledMaxHeight),i.y2-t.cropperScaledMinHeight);break;case"topright":i.x2=Math.max(Math.min(e.cropper.x2+o,i.x1+t.cropperScaledMaxWidth),i.x1+t.cropperScaledMinWidth),i.y1=Math.min(Math.max(e.cropper.y1+a,i.y2-t.cropperScaledMaxHeight),i.y2-t.cropperScaledMinHeight);break;case"right":i.x2=Math.max(Math.min(e.cropper.x2+o,i.x1+t.cropperScaledMaxWidth),i.x1+t.cropperScaledMinWidth);break;case"bottomright":i.x2=Math.max(Math.min(e.cropper.x2+o,i.x1+t.cropperScaledMaxWidth),i.x1+t.cropperScaledMinWidth),i.y2=Math.max(Math.min(e.cropper.y2+a,i.y1+t.cropperScaledMaxHeight),i.y1+t.cropperScaledMinHeight);break;case"bottom":i.y2=Math.max(Math.min(e.cropper.y2+a,i.y1+t.cropperScaledMaxHeight),i.y1+t.cropperScaledMinHeight);break;case"bottomleft":i.x1=Math.min(Math.max(e.cropper.x1+o,i.x2-t.cropperScaledMaxWidth),i.x2-t.cropperScaledMinWidth),i.y2=Math.max(Math.min(e.cropper.y2+a,i.y1+t.cropperScaledMaxHeight),i.y1+t.cropperScaledMinHeight);break;case"center":let s="scale"in r?r.scale:1,n=Math.min(Math.max(t.cropperScaledMinWidth,Math.abs(e.cropper.x2-e.cropper.x1)*s),t.cropperScaledMaxWidth),d=Math.min(Math.max(t.cropperScaledMinHeight,Math.abs(e.cropper.y2-e.cropper.y1)*s),t.cropperScaledMaxHeight);i.x1=e.clientX-n/2,i.x2=e.clientX+n/2,i.y1=e.clientY-d/2,i.y2=e.clientY+d/2,i.x1<0?(i.x2-=i.x1,i.x1=0):i.x2>t.maxSize().width&&(i.x1-=i.x2-t.maxSize().width,i.x2=t.maxSize().width),i.y1<0?(i.y2-=i.y1,i.y1=0):i.y2>t.maxSize().height&&(i.y1-=i.y2-t.maxSize().height,i.y2=t.maxSize().height);break}return t.options.maintainAspectRatio?wt(e.position,i,t):i}function wt(r,e,t){e=_({},e);let i=0,o=0;switch(r){case"top":e.x2=e.x1+(e.y2-e.y1)*t.options.aspectRatio,i=Math.max(e.x2-t.maxSize().width,0),o=Math.max(0-e.y1,0),(i>0||o>0)&&(e.x2-=o*t.options.aspectRatio>i?o*t.options.aspectRatio:i,e.y1+=o*t.options.aspectRatio>i?o:i/t.options.aspectRatio);break;case"bottom":e.x2=e.x1+(e.y2-e.y1)*t.options.aspectRatio,i=Math.max(e.x2-t.maxSize().width,0),o=Math.max(e.y2-t.maxSize().height,0),(i>0||o>0)&&(e.x2-=o*t.options.aspectRatio>i?o*t.options.aspectRatio:i,e.y2-=o*t.options.aspectRatio>i?o:i/t.options.aspectRatio);break;case"topleft":e.y1=e.y2-(e.x2-e.x1)/t.options.aspectRatio,i=Math.max(0-e.x1,0),o=Math.max(0-e.y1,0),(i>0||o>0)&&(e.x1+=o*t.options.aspectRatio>i?o*t.options.aspectRatio:i,e.y1+=o*t.options.aspectRatio>i?o:i/t.options.aspectRatio);break;case"topright":e.y1=e.y2-(e.x2-e.x1)/t.options.aspectRatio,i=Math.max(e.x2-t.maxSize().width,0),o=Math.max(0-e.y1,0),(i>0||o>0)&&(e.x2-=o*t.options.aspectRatio>i?o*t.options.aspectRatio:i,e.y1+=o*t.options.aspectRatio>i?o:i/t.options.aspectRatio);break;case"right":case"bottomright":e.y2=e.y1+(e.x2-e.x1)/t.options.aspectRatio,i=Math.max(e.x2-t.maxSize().width,0),o=Math.max(e.y2-t.maxSize().height,0),(i>0||o>0)&&(e.x2-=o*t.options.aspectRatio>i?o*t.options.aspectRatio:i,e.y2-=o*t.options.aspectRatio>i?o:i/t.options.aspectRatio);break;case"left":case"bottomleft":e.y2=e.y1+(e.x2-e.x1)/t.options.aspectRatio,i=Math.max(0-e.x1,0),o=Math.max(e.y2-t.maxSize().height,0),(i>0||o>0)&&(e.x1+=o*t.options.aspectRatio>i?o*t.options.aspectRatio:i,e.y2-=o*t.options.aspectRatio>i?o:i/t.options.aspectRatio);break;case"center":e.x2=e.x1+(e.y2-e.y1)*t.options.aspectRatio,e.y2=e.y1+(e.x2-e.x1)/t.options.aspectRatio;let a=Math.max(0-e.x1,0),s=Math.max(e.x2-t.maxSize().width,0),n=Math.max(e.y2-t.maxSize().height,0),d=Math.max(0-e.y1,0);(a>0||s>0||n>0||d>0)&&(e.x1+=n*t.options.aspectRatio>a?n*t.options.aspectRatio:a,e.x2-=d*t.options.aspectRatio>s?d*t.options.aspectRatio:s,e.y1+=d*t.options.aspectRatio>s?d:s/t.options.aspectRatio,e.y2-=n*t.options.aspectRatio>a?n:a/t.options.aspectRatio);break}return e}function ae(r){return"touches"in r&&r.touches[0]?r.touches[0].clientX:"clientX"in r?r.clientX:0}function re(r){return"touches"in r&&r.touches[0]?r.touches[0].clientY:"clientX"in r?r.clientY:0}var Me=class{constructor(){this.cropper=A({x1:0,x2:0,y1:0,y2:0}),this.maxSize=A({width:0,height:0}),this.transform={},this.options={format:"png",output:"blob",autoCrop:!0,maintainAspectRatio:!0,aspectRatio:1,resetCropOnAspectRatioChange:!0,resizeToWidth:0,resizeToHeight:0,cropperMinWidth:0,cropperMinHeight:0,cropperMaxHeight:0,cropperMaxWidth:0,cropperStaticWidth:0,cropperStaticHeight:0,canvasRotation:0,roundCropper:!1,onlyScaleDown:!1,imageQuality:92,backgroundColor:void 0,containWithinAspectRatio:!1,hideResizeSquares:!1,alignImage:"center",cropperFrameAriaLabel:void 0,checkImageType:!0},this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=3}setOptionsFromChanges(e){e.options?.currentValue&&this.setOptions(e.options.currentValue);let t=Object.entries(e).filter(([i])=>i in this.options).reduce((i,[o,a])=>T(_({},i),{[o]:a.currentValue}),{});Object.keys(t).length>0&&this.setOptions(t)}setOptions(e){if(this.options=_(_({},this.options),e||{}),this.validateOptions(),!this.loadedImage?.transformed.image.complete||!this.maxSize)return;let t=!1;this.options.maintainAspectRatio&&e.aspectRatio||"maintainAspectRatio"in e?(this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.options.maintainAspectRatio&&(this.options.resetCropOnAspectRatioChange||!this.aspectRatioIsCorrect())&&(this.cropper.set(this.maxSizeCropperPosition()),t=!0)):((e.cropperMinWidth||e.cropperMinHeight)&&(this.setCropperScaledMinSize(),t=!0),(e.cropperMaxWidth||e.cropperMaxHeight)&&(this.setCropperScaledMaxSize(),t=!0),(e.cropperStaticWidth||e.cropperStaticHeight)&&(t=!0)),t&&this.cropper.update(i=>X(i,this,!1))}validateOptions(){if(this.options.maintainAspectRatio&&!this.options.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}setMaxSize(e,t){this.maxSize.set({width:e,height:t}),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize()}setCropperScaledMinSize(){this.loadedImage?.transformed.size?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.cropperScaledMinWidth=this.options.cropperMinWidth>0?Math.max(20,this.options.cropperMinWidth/this.loadedImage.transformed.size.width*this.maxSize().width):20}setCropperScaledMinHeight(){this.options.maintainAspectRatio?this.cropperScaledMinHeight=Math.max(20,this.cropperScaledMinWidth/this.options.aspectRatio):this.options.cropperMinHeight>0?this.cropperScaledMinHeight=Math.max(20,this.options.cropperMinHeight/this.loadedImage.transformed.size.height*this.maxSize().height):this.cropperScaledMinHeight=20}setCropperScaledMaxSize(){if(this.loadedImage?.transformed.size){let e=this.loadedImage.transformed.size.width/this.maxSize().width;this.cropperScaledMaxWidth=this.options.cropperMaxWidth>20?this.options.cropperMaxWidth/e:this.maxSize().width,this.cropperScaledMaxHeight=this.options.cropperMaxHeight>20?this.options.cropperMaxHeight/e:this.maxSize().height,this.options.maintainAspectRatio&&(this.cropperScaledMaxWidth>this.cropperScaledMaxHeight*this.options.aspectRatio?this.cropperScaledMaxWidth=this.cropperScaledMaxHeight*this.options.aspectRatio:this.cropperScaledMaxWidth<this.cropperScaledMaxHeight*this.options.aspectRatio&&(this.cropperScaledMaxHeight=this.cropperScaledMaxWidth/this.options.aspectRatio))}else this.cropperScaledMaxWidth=this.maxSize().width,this.cropperScaledMaxHeight=this.maxSize().height}equalsCropperPosition(e){let t=this.cropper();return t==null&&e==null||t!=null&&e!=null&&t.x1.toFixed(3)===e.x1.toFixed(3)&&t.y1.toFixed(3)===e.y1.toFixed(3)&&t.x2.toFixed(3)===e.x2.toFixed(3)&&t.y2.toFixed(3)===e.y2.toFixed(3)}equalsTransformTranslate(e){return(this.transform.translateH??0)===(e.translateH??0)&&(this.transform.translateV??0)===(e.translateV??0)}equalsTransform(e){return this.equalsTransformTranslate(e)&&(this.transform.scale??1)===(e.scale??1)&&(this.transform.rotate??0)===(e.rotate??0)&&(this.transform.flipH??!1)===(e.flipH??!1)&&(this.transform.flipV??!1)===(e.flipV??!1)}aspectRatioIsCorrect(){let e=this.cropper();return(e.x2-e.x1)/(e.y2-e.y1)===this.options.aspectRatio}resizeCropperPosition(e){(e.width!==this.maxSize().width||e.height!==this.maxSize().height)&&this.cropper.update(t=>({x1:t.x1*this.maxSize().width/e.width,x2:t.x2*this.maxSize().width/e.width,y1:t.y1*this.maxSize().height/e.height,y2:t.y2*this.maxSize().height/e.height}))}maxSizeCropperPosition(){return{x1:0,y1:0,x2:this.maxSize().width,y2:this.maxSize().height}}toCropInput(){return{cropper:this.cropper(),maxSize:this.maxSize(),transform:this.transform,loadedImage:this.loadedImage,options:_({},this.options)}}},w=function(r){return r.Drag="drag",r.Move="move",r.Resize="resize",r.Pinch="pinch",r}(w||{});function bt(r,e,t){let i=r.width,o=r.height;e=Math.round(e),t=Math.round(t);let a=i/e,s=o/t,n=Math.ceil(a/2),d=Math.ceil(s/2),C=r.getContext("2d");if(C){let F=C.getImageData(0,0,i,o),I=C.createImageData(e,t),v=F.data,y=I.data;for(let z=0;z<t;z++)for(let U=0;U<e;U++){let Y=(U+z*e)*4,mt=z*s,R=0,N=0,Ie=0,ze=0,Re=0,Te=0,Se=0,ht=Math.floor(U*a),dt=Math.floor(z*s),de=Math.ceil((U+1)*a),ge=Math.ceil((z+1)*s);de=Math.min(de,i),ge=Math.min(ge,o);for(let Q=dt;Q<ge;Q++){let Oe=Math.abs(mt-Q)/d,gt=U*a,ut=Oe*Oe;for(let $=ht;$<de;$++){let Ae=Math.abs(gt-$)/n,D=Math.sqrt(ut+Ae*Ae);if(D>=1)continue;R=2*D*D*D-3*D*D+1;let H=4*($+Q*i);Se+=R*v[H+3],Ie+=R,v[H+3]<255&&(R=R*v[H+3]/250),ze+=R*v[H],Re+=R*v[H+1],Te+=R*v[H+2],N+=R}}y[Y]=ze/N,y[Y+1]=Re/N,y[Y+2]=Te/N,y[Y+3]=Se/Ie}r.width=e,r.height=t,C.putImageData(I,0,0)}}function pt(r,e){return r/100*e}var we=class{crop(e,t){let i=this.getImagePosition(e),o=i.x2-i.x1,a=i.y2-i.y1,s=document.createElement("canvas");s.width=o,s.height=a;let n=s.getContext("2d");if(!n)return null;e.options?.backgroundColor!=null&&(n.fillStyle=e.options.backgroundColor,n.fillRect(0,0,o,a));let d=(e.transform?.scale||1)*(e.transform?.flipH?-1:1),C=(e.transform?.scale||1)*(e.transform?.flipV?-1:1),{translateH:F,translateV:I}=this.getCanvasTranslate(e),v=e.loadedImage.transformed;n.setTransform(d,0,0,C,v.size.width/2+F,v.size.height/2+I),n.translate(-i.x1/d,-i.y1/C),n.rotate((e.transform?.rotate||0)*Math.PI/180),n.drawImage(v.image,-v.size.width/2,-v.size.height/2);let y={width:o,height:a,imagePosition:i,cropperPosition:_({},e.cropper)};e.options?.containWithinAspectRatio&&(y.offsetImagePosition=this.getOffsetImagePosition(e));let z=this.getResizeRatio(o,a,e.options);return z!==1&&(y.width=Math.round(o*z),y.height=e.options?.maintainAspectRatio?Math.round(y.width/(e.options?.aspectRatio??1)):Math.round(a*z),bt(s,y.width,y.height)),t==="blob"?this.cropToBlob(y,s,e):(y.base64=s.toDataURL("image/"+(e.options?.format??"png"),this.getQuality(e.options)),y)}async cropToBlob(e,t,i){return e.blob=await new Promise(o=>t.toBlob(o,"image/"+(i.options?.format??"png"),this.getQuality(i.options))),e.blob&&(e.objectUrl=URL.createObjectURL(e.blob)),e}getCanvasTranslate(e){if(e.transform?.translateUnit==="px"){let t=this.getRatio(e);return{translateH:(e.transform?.translateH||0)*t,translateV:(e.transform?.translateV||0)*t}}else return{translateH:e.transform?.translateH?pt(e.transform.translateH,e.loadedImage.transformed.size.width):0,translateV:e.transform?.translateV?pt(e.transform.translateV,e.loadedImage.transformed.size.height):0}}getRatio(e){return e.loadedImage.transformed.size.width/e.maxSize.width}getImagePosition(e){let t=this.getRatio(e),i={x1:Math.round(e.cropper.x1*t),y1:Math.round(e.cropper.y1*t),x2:Math.round(e.cropper.x2*t),y2:Math.round(e.cropper.y2*t)};return e.options?.containWithinAspectRatio||(i.x1=Math.max(i.x1,0),i.y1=Math.max(i.y1,0),i.x2=Math.min(i.x2,e.loadedImage.transformed.size.width),i.y2=Math.min(i.y2,e.loadedImage.transformed.size.height)),i}getOffsetImagePosition(e){let t=(e.options?.canvasRotation??0)+e.loadedImage.exifTransform.rotate,i=this.getRatio(e),o,a;t%2?(o=(e.loadedImage.transformed.size.width-e.loadedImage.original.size.height)/2,a=(e.loadedImage.transformed.size.height-e.loadedImage.original.size.width)/2):(o=(e.loadedImage.transformed.size.width-e.loadedImage.original.size.width)/2,a=(e.loadedImage.transformed.size.height-e.loadedImage.original.size.height)/2);let s=e.cropper,n={x1:Math.round(s.x1*i)-o,y1:Math.round(s.y1*i)-a,x2:Math.round(s.x2*i)-o,y2:Math.round(s.y2*i)-a};return e.options?.containWithinAspectRatio||(n.x1=Math.max(n.x1,0),n.y1=Math.max(n.y1,0),n.x2=Math.min(n.x2,e.loadedImage.transformed.size.width),n.y2=Math.min(n.y2,e.loadedImage.transformed.size.height)),n}getResizeRatio(e,t,i){let o=new Array;i?.resizeToWidth&&i.resizeToWidth>0&&o.push(i.resizeToWidth/e),i?.resizeToHeight&&i.resizeToHeight>0&&o.push(i.resizeToHeight/t);let a=o.length===0?1:Math.min(...o);return a>1&&!i?.onlyScaleDown?a:Math.min(a,1)}getQuality(e){return Math.min(1,Math.max(0,(e?.imageQuality??92)/100))}},It=[new Uint8Array([255,216,255,225,0,34,69,120,105,102,0,0,77,77,0,42,0,0,0,8,0,1,1,18,0,3,0,0,0,1,0,6,0,0,0,0,0,0,255,219,0,132,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,255,192,0,17,8,0,1,0,2,3,1,17,0,2,17,1,3,17,1,255,196,0,74,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,16,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,218,0,12,3,1,0,2,17,3,17,0,63,0,63,240,127,255,217])],zt=URL.createObjectURL(new Blob(It,{type:"image/jpeg"}));function Rt(){return new Promise(r=>{let e=new Image;e.onload=()=>{let t=e.width===1&&e.height===2;r(t)},e.src=zt})}function Tt(r){switch(typeof r=="object"&&(r=St(r)),r){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}function St(r){let e=new DataView(r);if(e.getUint16(0,!1)!==65496)return-2;let t=e.byteLength,i=2;for(;i<t;){if(e.getUint16(i+2,!1)<=8)return-1;let o=e.getUint16(i,!1);if(i+=2,o==65505){if(e.getUint32(i+=2,!1)!==1165519206)return-1;let a=e.getUint16(i+=6,!1)==18761;i+=e.getUint32(i+4,a);let s=e.getUint16(i,a);i+=2;for(let n=0;n<s;n++)if(e.getUint16(i+n*12,a)==274)return e.getUint16(i+n*12+8,a)}else{if((o&65280)!==65280)break;i+=e.getUint16(i,!1)}}return-1}var be=class{constructor(){this.autoRotateSupported=Rt()}async loadImageFile(e,t){let i=await e.arrayBuffer();return t.checkImageType?await this.checkImageTypeAndLoadImageFromArrayBuffer(i,e.type,t):await this.loadImageFromArrayBuffer(i,t)}checkImageTypeAndLoadImageFromArrayBuffer(e,t,i){return this.isValidImageType(t)?this.loadImageFromArrayBuffer(e,i,t):Promise.reject(new Error("Invalid image type"))}isValidImageType(e){return/image\/(png|jpg|jpeg|heic|bmp|gif|tiff|svg|webp|x-icon|vnd.microsoft.icon)/.test(e)}async loadImageFromURL(e,t){let o=await(await fetch(e)).blob(),a=await o.arrayBuffer();return await this.loadImageFromArrayBuffer(a,t,o.type)}loadBase64Image(e,t){let i=this.base64ToArrayBuffer(e);return this.loadImageFromArrayBuffer(i,t)}base64ToArrayBuffer(e){e=e.replace(/^data:([^;]+);base64,/gmi,"");let t=atob(e),i=t.length,o=new Uint8Array(i);for(let a=0;a<i;a++)o[a]=t.charCodeAt(a);return o.buffer}async loadImageFromArrayBuffer(e,t,i){let o=await new Promise(async(a,s)=>{try{let n=new Blob([e],i?{type:i}:void 0),d=URL.createObjectURL(n),C=new Image,I=i==="image/svg+xml"?await this.getSvgImageSize(n):void 0;C.onload=()=>a({originalImage:C,originalImageSize:I,originalObjectUrl:d,originalArrayBuffer:e}),C.onerror=s,C.src=d}catch(n){s(n)}});return await this.transformImageFromArrayBuffer(o,t,o.originalImageSize!=null)}async getSvgImageSize(e){let o=new DOMParser().parseFromString(await e.text(),"image/svg+xml").querySelector("svg");if(!o)throw Error("Failed to parse SVG image");let a=o.getAttribute("width"),s=o.getAttribute("height");if(a&&s)return null;let n=o.getAttribute("viewBox")||o.getAttribute("viewbox");if(n){let d=n.split(" ");return{width:+d[2],height:+d[3]}}throw Error("Failed to load SVG image. SVG must have width + height or viewBox definition.")}async transformImageFromArrayBuffer(e,t,i=!1){let o=await this.autoRotateSupported,a=Tt(o?-1:e.originalArrayBuffer);if(!e.originalImage||!e.originalImage.complete)return Promise.reject(new Error("No image loaded"));let s={original:{objectUrl:e.originalObjectUrl,image:e.originalImage,size:e.originalImageSize??{width:e.originalImage.naturalWidth,height:e.originalImage.naturalHeight}},exifTransform:a};return this.transformLoadedImage(s,t,i)}async transformLoadedImage(e,t,i=!1){let o=(t.canvasRotation??0)+e.exifTransform.rotate,a=e.original.size;if(!i&&o===0&&!e.exifTransform.flip&&!t.containWithinAspectRatio)return{original:{objectUrl:e.original.objectUrl,image:e.original.image,size:_({},a)},transformed:{objectUrl:e.original.objectUrl,image:e.original.image,size:_({},a)},exifTransform:e.exifTransform};let s=this.getTransformedSize(a,e.exifTransform,t),n=document.createElement("canvas");n.width=s.width,n.height=s.height;let d=n.getContext("2d");d?.setTransform(e.exifTransform.flip?-1:1,0,0,1,n.width/2,n.height/2),d?.rotate(Math.PI*(o/2)),d?.drawImage(e.original.image,-a.width/2,-a.height/2);let C=await new Promise(v=>n.toBlob(v,"image/"+(t.format??"png")));if(!C)throw new Error("Failed to get Blob for transformed image.");let F=URL.createObjectURL(C),I=await this.loadImageFromObjectUrl(F);return{original:{objectUrl:e.original.objectUrl,image:e.original.image,size:_({},a)},transformed:{objectUrl:F,image:I,size:{width:I.width,height:I.height}},exifTransform:e.exifTransform}}loadImageFromObjectUrl(e){return new Promise((t,i)=>{let o=new Image;o.onload=()=>t(o),o.onerror=i,o.src=e})}getTransformedSize(e,t,i){let o=(i.canvasRotation??0)+t.rotate;if(i.containWithinAspectRatio)if(o%2){let a=e.width*(i.aspectRatio??1),s=e.height/(i.aspectRatio??1);return{width:Math.max(e.height,a),height:Math.max(e.width,s)}}else{let a=e.height*(i.aspectRatio??1),s=e.width/(i.aspectRatio??1);return{width:Math.max(e.width,a),height:Math.max(e.height,s)}}return o%2?{height:e.width,width:e.height}:{width:e.width,height:e.height}}};function Ot(r){switch(r){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";case"ArrowLeft":default:return"left"}}function At(r){switch(r){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";case"ArrowLeft":default:return"right"}}function Pt(r,e){switch(r){case"ArrowUp":return{clientX:0,clientY:e*-1};case"ArrowRight":return{clientX:e,clientY:0};case"ArrowDown":return{clientX:0,clientY:e};case"ArrowLeft":default:return{clientX:e*-1,clientY:0}}}var lt=(()=>{class r{get alignImageStyle(){return this.state.options.alignImage}constructor(t){this.sanitizer=t,this.pinchStart$=new Pe,this.cropService=new we,this.loadImageService=new be,this.setImageMaxSizeRetries=0,this.resizedWhileHidden=!1,this.moveTypes=w,this.state=new Me,this.safeImgDataUrl=A(void 0),this.safeTransformStyle=A(void 0),this.marginLeft="0px",this.imageVisible=!1,this.allowMoveImage=!1,this.checkImageType=!0,this.disabled=!1,this.hidden=!1,this.imageCropped=O(),this.startCropImage=O(),this.imageLoaded=O(),this.cropperReady=O(),this.loadImageFailed=O(),this.transformChange=O(),this.cropperChange=O(),this.reset()}ngOnInit(){this.state.stepSize=this.initialStepSize||this.state.stepSize}ngOnChanges(t){let i=this.state.cropper(),o=this.state.transform,a=this.state.options.backgroundColor;if(this.state.setOptionsFromChanges(t),this.onChangesInputImage(t),t.transform&&this.transform&&(this.state.transform=this.transform,this.setCssTransform()),!this.state.loadedImage?.transformed.image.complete||!this.state.maxSize)return;if(this.containWithinAspectRatio&&t.aspectRatio||t.containWithinAspectRatio||t.canvasRotation){this.loadImageService.transformLoadedImage(this.state.loadedImage,this.state.options).then(n=>this.setLoadedImage(n)).catch(n=>this.loadImageError(n));return}t.cropper&&this.cropper&&this.state.cropper.set(X(this.cropper,this.state,!0));let s=!this.state.equalsCropperPosition(i);s&&(!this.cropper||!this.state.equalsCropperPosition(this.cropper))&&this.cropperChange.emit(this.state.cropper()),(s||!this.state.equalsTransform(o)||this.state.options.backgroundColor!==a)&&this.doAutoCrop(),t.hidden&&this.resizedWhileHidden&&!this.hidden&&setTimeout(()=>{this.onResize(),this.resizedWhileHidden=!1})}onChangesInputImage(t){(t.imageChangedEvent||t.imageURL||t.imageBase64||t.imageFile)&&this.reset(),t.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),t.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),t.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),t.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}isValidImageChangedEvent(){let t=this.imageChangedEvent?.target?.files;return t instanceof FileList&&t.length>0}reset(){this.state.loadedImage=void 0,this.state.maxSize.set({width:0,height:0}),this.imageVisible=!1}loadImageFile(t){this.loadImageService.loadImageFile(t,this.state.options).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i))}loadBase64Image(t){this.loadImageService.loadBase64Image(t,this.state.options).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i))}loadImageFromURL(t){this.loadImageService.loadImageFromURL(t,this.state.options).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i))}setLoadedImage(t){this.state.loadedImage=t,this.safeImgDataUrl.set(this.sanitizer.bypassSecurityTrustResourceUrl(t.transformed.objectUrl))}loadImageError(t){console.error(t),this.loadImageFailed.emit()}setCssTransform(){let t=this.state.transform?.translateUnit||"%";this.safeTransformStyle.set(this.sanitizer.bypassSecurityTrustStyle(`translate(${this.state.transform.translateH||0}${t}, ${this.state.transform.translateV||0}${t}) scaleX(`+(this.state.transform.scale||1)*(this.state.transform.flipH?-1:1)+") scaleY("+(this.state.transform.scale||1)*(this.state.transform.flipV?-1:1)+") rotate("+(this.state.transform.rotate||0)+"deg)"))}imageLoadedInView(){this.state.loadedImage!=null&&(this.imageLoaded.emit(this.state.loadedImage),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.cropper&&(!this.maintainAspectRatio||this.state.aspectRatioIsCorrect())?(this.state.cropper.set(X(this.cropper,this.state,!0)),this.emitCropperPositionChange(this.cropper)):(this.state.cropper.set(X(this.state.maxSizeCropperPosition(),this.state,!0)),this.cropperChange.emit(this.state.cropper())),this.imageVisible=!0,this.cropperReady.emit(this.state.maxSize()),this.doAutoCrop()):(this.setImageMaxSizeRetries++,setTimeout(()=>this.checkImageMaxSizeRecursively(),50))}sourceImageLoaded(){return this.sourceImage?.nativeElement?.offsetWidth>1}onResize(){if(this.state.loadedImage)if(this.hidden)this.resizedWhileHidden=!0;else{let t=this.state.maxSize();this.setMaxSize(),this.state.resizeCropperPosition(t)}}keyboardAccess(t){this.changeKeyboardStepSize(t),this.keyboardMoveCropper(t)}changeKeyboardStepSize(t){let i=+t.key;i>=1&&i<=9&&(this.state.stepSize=i)}keyboardMoveCropper(t){if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t.key))return;let o=t.shiftKey?w.Resize:w.Move,a=t.altKey?At(t.key):Ot(t.key),s=Pt(t.key,this.state.stepSize);t.preventDefault(),t.stopPropagation(),this.moveStart={type:o,position:a,clientX:0,clientY:0,transform:this.state.transform,cropper:this.state.cropper()},this.handleMouseMove(s),this.handleMouseUp()}startMove(t,i,o=null){this.disabled||this.moveStart&&this.moveStart.type===w.Pinch||i===w.Drag&&!this.allowMoveImage||("preventDefault"in t&&t.preventDefault(),this.moveStart={type:i,position:o,clientX:ae(t),clientY:re(t),transform:this.state.transform,cropper:this.state.cropper()},this.initMouseMove())}initMouseMove(){ue(V(document,"mousemove"),V(document,"touchmove")).pipe(fe(ue(V(document,"mouseup"),V(document,"touchend"),this.pinchStart$).pipe(Fe()))).subscribe({next:t=>this.handleMouseMove(t),complete:()=>this.handleMouseUp()})}handleMouseMove(t){if(this.moveStart){if("stopPropagation"in t&&t.stopPropagation(),"preventDefault"in t&&t.preventDefault(),this.moveStart.type===w.Move)this.state.cropper.set(oe(Mt(t,this.moveStart),this.state,!0));else if(this.moveStart.type===w.Resize)!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.state.cropper.set(oe(ct(t,this.moveStart,this.state),this.state,!1));else if(this.moveStart.type===w.Drag){let i=ae(t)-this.moveStart.clientX,o=re(t)-this.moveStart.clientY;this.state.transform=T(_({},this.state.transform),{translateH:(this.moveStart.transform?.translateH||0)+i,translateV:(this.moveStart.transform?.translateV||0)+o}),this.setCssTransform()}}}handleMouseUp(){!this.moveStart||this.moveStart.type===w.Pinch||((!this.state.equalsCropperPosition(this.moveStart.cropper)||this.moveStart.transform&&!this.state.equalsTransform(this.moveStart.transform))&&(this.moveStart.type===w.Drag?this.transformChange.emit(this.state.transform):this.cropperChange.emit(this.state.cropper()),this.doAutoCrop()),this.moveStart=void 0)}startPinch(t){if(this.disabled||!this.sourceImageLoaded()||t.touches.length<2)return;"preventDefault"in t&&t.preventDefault();let i=this.state.cropper();this.moveStart={type:w.Pinch,position:"center",clientX:i.x1+(i.x2-i.x1)/2,clientY:i.y1+(i.y2-i.y1)/2,cropper:i},this.initPinch()}initPinch(){this.pinchStart$.next(),V(document,"touchmove").pipe(fe(V(document,"touchend"))).subscribe({next:t=>this.handlePinchMove(t),complete:()=>this.handlePinchStop()})}handlePinchMove(t){this.moveStart&&(t.preventDefault&&t.preventDefault(),this.moveStart.type===w.Pinch&&!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.state.cropper.set(oe(ct(t,this.moveStart,this.state),this.state,!1)))}handlePinchStop(){this.moveStart&&(this.state.equalsCropperPosition(this.moveStart.cropper)||(this.emitCropperPositionChange(this.moveStart.cropper),this.doAutoCrop()),this.moveStart=void 0)}setMaxSize(){if(this.sourceImage){let t=getComputedStyle(this.sourceImage.nativeElement);this.state.setMaxSize(parseFloat(t.width),parseFloat(t.height)),this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.state.maxSize().width/2+"px)")}}emitCropperPositionChange(t){this.state.equalsCropperPosition(t)||this.cropperChange.emit(this.state.cropper())}doAutoCrop(){this.state.options.autoCrop&&this.crop()}crop(t=this.state.options.output){if(this.state.loadedImage?.transformed?.image!=null){if(this.startCropImage.emit(),t==="blob")return this.cropToBlob();if(t==="base64")return this.cropToBase64()}return null}cropToBlob(){return new Promise(async(t,i)=>{let o=await this.cropService.crop(this.state.toCropInput(),"blob");o?(this.imageCropped.emit(o),t(o)):i("Crop image failed")})}cropToBase64(){let t=this.cropService.crop(this.state.toCropInput(),"base64");return t?(this.imageCropped.emit(t),t):null}resetCropperPosition(){this.state.cropper.set(X(this.state.maxSizeCropperPosition(),this.state,!0)),this.cropperChange.emit(this.state.cropper())}ngOnDestroy(){this.pinchStart$.complete()}static{this.\u0275fac=function(i){return new(i||r)(K(qe))}}static{this.\u0275cmp=b({type:r,selectors:[["image-cropper"]],viewQuery:function(i,o){if(i&1&&(_e(ft,7),_e(xt,5)),i&2){let a;Ce(a=ve())&&(o.wrapper=a.first),Ce(a=ve())&&(o.sourceImage=a.first)}},hostVars:6,hostBindings:function(i,o){i&1&&g("resize",function(){return o.onResize()},!1,De),i&2&&(P("text-align",o.alignImageStyle),G("disabled",o.disabled)("ngx-ic-hidden",o.hidden))},inputs:{imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile",imageAltText:"imageAltText",options:"options",cropperFrameAriaLabel:"cropperFrameAriaLabel",output:"output",format:"format",autoCrop:"autoCrop",cropper:"cropper",transform:"transform",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resetCropOnAspectRatioChange:"resetCropOnAspectRatioChange",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperMaxHeight:"cropperMaxHeight",cropperMaxWidth:"cropperMaxWidth",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",backgroundColor:"backgroundColor",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",allowMoveImage:"allowMoveImage",checkImageType:"checkImageType",alignImage:"alignImage",disabled:"disabled",hidden:"hidden"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed",transformChange:"transformChange",cropperChange:"cropperChange"},features:[Ue],decls:4,vars:10,consts:[["sourceImage",""],[3,"touchstart"],["class","ngx-ic-source-image","role","presentation",3,"src","visibility","transform","ngx-ic-draggable","load","mousedown","touchstart","error",4,"ngIf"],[1,"ngx-ic-overlay"],["class","ngx-ic-cropper","tabindex","0",3,"ngx-ic-round","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],["role","presentation",1,"ngx-ic-source-image",3,"load","mousedown","touchstart","error","src"],["tabindex","0",1,"ngx-ic-cropper",3,"keydown"],["role","presentation",1,"ngx-ic-move",3,"mousedown","touchstart"],[4,"ngIf"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topleft",3,"mousedown","touchstart"],[1,"ngx-ic-square"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topright",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomright",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomleft",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-top",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-top",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-right",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-right",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-bottom",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-bottom",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-left",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-left",3,"mousedown","touchstart"]],template:function(i,o){i&1&&(m(0,"div",1),g("touchstart",function(s){return o.startPinch(s)}),S(1,_t,2,8,"img",2),u(2,"div",3),S(3,vt,3,16,"div",4),h()),i&2&&(P("background",o.imageVisible&&o.state.options.backgroundColor),f(),x("ngIf",o.safeImgDataUrl()),f(),P("width",o.state.maxSize().width||0,"px")("height",o.state.maxSize().height||0,"px")("margin-left",o.state.options.alignImage==="center"?o.marginLeft:null),f(),x("ngIf",o.imageVisible))},dependencies:[J],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image[_ngcontent-%COMP%]{display:inline;max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image.ngx-ic-draggable[_ngcontent-%COMP%]{user-drag:none;-webkit-user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:grab}[_nghost-%COMP%]   .ngx-ic-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;outline:var(--cropper-overlay-color, white) solid 100vw;top:0;left:0}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:var(--cropper-color, #53535C);background:transparent;outline:var(--cropper-outline-color, rgba(255, 255, 255, .3)) solid 100vw;touch-action:none}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{outline-width:100vh}}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";inset:0;pointer-events:none;border:dashed 1px;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{width:100%;cursor:move;border:var(--cropper-border, 1px solid rgba(255, 255, 255, .5))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:hover   .ngx-ic-move[_ngcontent-%COMP%]{border:var(--cropper-hover-border, var(--cropper-border, 1px solid rgba(255, 255, 255, .5)))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-move[_ngcontent-%COMP%]{border:var(--cropper-focus-border, 2px solid dodgerblue)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{background:var(--cropper-resize-square-focus-bg, var(--cropper-resize-square-bg, #53535C));border:var(--cropper-resize-square-focus-border, var(--cropper-resize-square-border, 1px solid rgba(255, 255, 255, .5)))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{display:inline-block;width:6px;height:6px;box-sizing:content-box;background:var(--cropper-resize-square-bg, #53535C);border:var(--cropper-resize-square-border, 1px solid rgba(255, 255, 255, .5))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]:hover   .ngx-ic-square[_ngcontent-%COMP%]{background:var(--cropper-resize-square-hover-bg, var(--cropper-resize-square-bg, #53535C));border:var(--cropper-resize-square-hover-border, var(--cropper-resize-square-border, 1px solid rgba(255, 255, 255, .5)))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw var(--cropper-outline-color, rgba(255, 255, 255, .3))}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh var(--cropper-outline-color, rgba(255, 255, 255, .3))}}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{display:none}.ngx-ic-hidden[_nghost-%COMP%]{display:none}'],changeDetection:0})}}return r})();var ne=class r{imageChangedEvent=null;croppedEvent;data=M(Je);dialogRef=M(Ge);transform={scale:1};ngOnInit(){this.imageChangedEvent=this.data.event}crop(){this.dialogRef.close(this.croppedEvent.blob)}onWheel(e){console.log("WHEEL"),e.preventDefault();let t=e.deltaY>0?-.05:.05;console.log("\u{1F538} delta:",t),this.transform=T(_({},this.transform),{scale:Math.min(5,Math.max(.5,(this.transform.scale??1)+t))}),console.log("\u{1F538} this.transform:",this.transform)}imageCropped(e){this.croppedEvent=e}imageLoaded(e){}cropperReady(){}loadImageFailed(){}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=b({type:r,selectors:[["app-avatar-crop-dialog"]],decls:8,vars:7,consts:[[1,"crop"],["mat-dialog-title","",1,"crop__title",3,"text"],[1,"crop__area",3,"wheel"],["format","png",3,"imageCropped","imageLoaded","cropperReady","loadImageFailed","imageChangedEvent","roundCropper","maintainAspectRatio","aspectRatio","transform"],["btnText","Crop",3,"click","btnDisabled"],["mat-dialog-close","","btnText","Cancel"]],template:function(t,i){t&1&&(m(0,"div",0),u(1,"app-h2-title",1),m(2,"mat-dialog-content")(3,"div",2),g("wheel",function(a){return i.onWheel(a)}),m(4,"image-cropper",3),g("imageCropped",function(a){return i.imageCropped(a)})("imageLoaded",function(a){return i.imageLoaded(a)})("cropperReady",function(){return i.cropperReady()})("loadImageFailed",function(){return i.loadImageFailed()}),h()()(),m(5,"mat-dialog-actions")(6,"app-btn-raised",4),g("click",function(){return i.crop()}),h(),u(7,"app-btn-raised",5),h()()),t&2&&(f(),x("text","Crop avatar"),f(3),x("imageChangedEvent",i.imageChangedEvent)("roundCropper",!0)("maintainAspectRatio",!0)("aspectRatio",1)("transform",i.transform),f(2),x("btnDisabled",!i.imageChangedEvent))},dependencies:[ee,lt,et,tt,nt],styles:[".crop__area[_ngcontent-%COMP%]{max-width:500px;max-height:500px;display:inline-flex}image-cropper[_ngcontent-%COMP%]{padding:0}"],changeDetection:0})};var ce=class r{apiService=M(Z);uploadAvatar(e){let t=new FormData;return t.append("image",e,e.name),this.apiService.post("/avatar",t)}uploadAvatarFromBlob(e){let t=new File([e],"avatar.png",{type:e.type}),i=new FormData;return i.append("image",t,t.name),this.apiService.post("/avatar",i)}static \u0275fac=function(t){return new(t||r)};static \u0275prov=Ve({token:r,factory:r.\u0275fac,providedIn:"root"})};function Vt(r,e){if(r&1&&(m(0,"p"),L(1,"URL: "),m(2,"a",5),L(3),h()()),r&2){let t=c(2);f(2),x("href",t.uploadedUrl,W),f(),ye(t.uploadedUrl)}}function Ut(r,e){if(r&1&&(m(0,"div",3)(1,"p"),L(2),h(),S(3,Vt,4,2,"p",4),h()),r&2){let t=c();f(),P("color",t.isError?"red":"green"),f(),ye(t.message),f(),x("ngIf",t.uploadedUrl)}}var pe=class r{constructor(e){this.imageService=e}selectedFile=null;isUploading=!1;message="";isError=!1;uploadedUrl=null;dialog=M(Ze);onFileSelected(e){let t=e.target.files[0];t&&(console.log("\u{1F538} file:",t),this.selectedFile=t,this.message="",this.uploadedUrl=null,this.openCropDialog(e))}openCropDialog(e){this.dialog.open(ne,{panelClass:["crop-dialog","green"],data:{event:e}}).afterClosed().subscribe(i=>{i!==void 0&&this.onUpload(i)})}onUpload(e){if(!this.selectedFile){this.message="\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0444\u0430\u0439\u043B \u0434\u043B\u044F \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438.",this.isError=!0;return}this.isUploading=!0,this.message="\u041D\u0430\u0447\u0430\u043B\u043E \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438...",this.isError=!1,this.uploadedUrl=null,this.imageService.uploadAvatarFromBlob(e).subscribe({next:t=>{this.message="\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043F\u0440\u043E\u0448\u043B\u0430 \u0443\u0441\u043F\u0435\u0448\u043D\u043E! ID: "+t.public_id,this.uploadedUrl=t.url,this.isError=!1,this.isUploading=!1,this.selectedFile=null},error:t=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438:",t),this.message="\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438: "+(t.error?.message||"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430."),this.isError=!0,this.isUploading=!1}})}static \u0275fac=function(t){return new(t||r)(K(ce))};static \u0275cmp=b({type:r,selectors:[["app-avatar-upload"]],decls:5,vars:1,consts:[[2,"padding","20px","border","1px solid #ccc","max-width","400px"],["type","file","accept","image/*",3,"change"],["style","margin-top: 15px;",4,"ngIf"],[2,"margin-top","15px"],[4,"ngIf"],["target","_blank",3,"href"]],template:function(t,i){t&1&&(m(0,"div",0)(1,"h2"),L(2,"\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0410\u0432\u0430\u0442\u0430\u0440\u043A\u0438 (\u0422\u0435\u0441\u0442)"),h(),m(3,"input",1),g("change",function(a){return i.onFileSelected(a)}),h(),S(4,Ut,4,4,"div",2),h()),t&2&&(f(4),x("ngIf",i.message))},dependencies:[je,J],encapsulation:2,changeDetection:0})};var le=class r{breadcrumbsService=M(te);constructor(){q(()=>{let e=this.breadcrumbsService.brcrTranslations();if(e){let t=[{label:e.homepage.name,url:e.homepage.url,icon:"home"},{label:e.user.name}];this.breadcrumbsService.setBreadcrumbs(t)}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=b({type:r,selectors:[["app-user-profile"]],decls:2,vars:0,template:function(t,i){t&1&&u(0,"app-breadcrumbs")(1,"app-avatar-upload")},dependencies:[ie,pe],encapsulation:2,changeDetection:0})};var Dt=(r,e)=>e.id;function Ht(r,e){r&1&&u(0,"app-loader")}function Wt(r,e){if(r&1){let t=E();m(0,"div",3),u(1,"app-h5-title",5),B(2,"translate"),u(3,"img",6),B(4,"translate"),m(5,"app-btn-flat",7),B(6,"translate"),g("click",function(){p(t);let o=c();return l(o.goToCatalog())}),h()()}if(r&2){let t=c();f(),x("text",j(2,4,"favs-page.empty")),f(2),x("src",t.imgUrl,W)("alt",j(4,6,"favs-page.title")),f(2),x("btnText",j(6,8,"favs-page.go-to-catalog"))}}function Et(r,e){if(r&1&&u(0,"app-product-card",8),r&2){let t=e.$implicit;x("product",t)("withStockAndRate",!0)}}function kt(r,e){if(r&1&&(m(0,"div",4),We(1,Et,1,2,"app-product-card",8,Dt),h()),r&2){let t=c();f(),Ee(t.products())}}var me=class r{favsService=M(at);apiService=M(Z);navigateService=M($e);breadcrumbsService=M(te);productIds=Be(()=>this.favsService.productIds());products=A([]);isLoading=A(!0);imgUrl=`${Ke}heroes/cat-freshok`;constructor(){q(()=>{this.productIds().length>0?(this.products.update(e=>e.filter(t=>this.productIds().includes(t.id))),this.loadFavProducts()):this.isLoading.set(!1)}),q(()=>{let e=this.breadcrumbsService.brcrTranslations();if(e){let t=[{label:e.homepage.name,url:e.homepage.url,icon:"home"},{label:e.user.name,url:e.user.url},{label:e.favs.name}];this.breadcrumbsService.setBreadcrumbs(t)}})}loadFavProducts(){if(this.productIds().length===0){this.products.set([]);return}this.apiService.get("/favs/products",[`productIds=${this.productIds()}`]).subscribe({next:e=>{this.products.set(e)},error:e=>{console.error("[FavsComponent] loadFavProducts error:",e)},complete:()=>this.isLoading.set(!1)})}goToCatalog(){this.navigateService.navigate(["/products"])}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=b({type:r,selectors:[["app-favs"]],decls:8,vars:4,consts:[[1,"favs-page"],[1,"container"],[1,"favs-page__title",3,"text"],[1,"favs-page__empty"],[1,"favs-page__grid"],[3,"text"],["width","300","height","300",3,"src","alt"],["borderRarius","6px",3,"click","btnText"],[3,"product","withStockAndRate"]],template:function(t,i){t&1&&(u(0,"app-breadcrumbs"),m(1,"div",0)(2,"div",1),u(3,"app-h2-title",2),B(4,"translate"),S(5,Ht,1,0,"app-loader")(6,Wt,7,10,"div",3)(7,kt,3,0,"div",4),h()()),t&2&&(f(3),x("text",j(4,2,"favs-page.title")),f(2),He(i.isLoading()?5:i.productIds().length===0?6:7))},dependencies:[rt,Qe,Ne,Ye,ot,ee,st,it,ie],styles:[".favs-page[_ngcontent-%COMP%]{padding:24px 0}.favs-page__title[_ngcontent-%COMP%]{margin-bottom:24px}.favs-page__empty[_ngcontent-%COMP%]{max-width:500px;margin:auto;display:flex;flex-direction:column;align-items:center;gap:24px;padding:50px 0;text-align:center}.favs-page__grid[_ngcontent-%COMP%]{margin-top:24px;margin-bottom:24px;display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px}@media (max-width: 576px){.favs-page__grid[_ngcontent-%COMP%]{grid-template-columns:minmax(170px,1fr) minmax(170px,1fr);gap:5px}}app-loader[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:64px 0}"],changeDetection:0})};var he=class r{static \u0275fac=function(t){return new(t||r)};static \u0275cmp=b({type:r,selectors:[["app-user"]],decls:1,vars:0,template:function(t,i){t&1&&u(0,"router-outlet")},dependencies:[Xe],encapsulation:2,changeDetection:0})};var to=[{path:"",component:he,children:[{path:"",redirectTo:"profile",pathMatch:"full"},{path:"profile",data:{roles:["customer"]},component:le},{path:"favs",component:me,data:{roles:["customer"]}}]}];export{to as routes};
